<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>DockerImagesOptimization | William&#39;s Blog</title>
<meta name="keywords" content="docker">
<meta name="description" content="Dockeré•œåƒä½“ç§¯ä¼˜åŒ–">
<meta name="author" content="deemoprobe">
<link rel="canonical" href="https://deemoprobe.github.io/posts/tech/dockerimagesoptimization/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.4ff503bcd1fac86ff7aae2a7670a5373c685d74bf74dc61eb3b14254f795b8f7.css" integrity="sha256-T/UDvNH6yG/3quKnZwpTc8aF10v3TcYes7FCVPeVuPc=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
        onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://deemoprobe.github.io/img/bear.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://deemoprobe.github.io/img/bear.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://deemoprobe.github.io/img/bear.gif">
<link rel="apple-touch-icon" href="https://deemoprobe.github.io/img/bear.gif">
<link rel="mask-icon" href="https://deemoprobe.github.io/img/bear.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script defer src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jquery@3.6.3/dist/jquery.min.js"></script>



<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="DockerImagesOptimization" />
<meta property="og:description" content="Dockeré•œåƒä½“ç§¯ä¼˜åŒ–" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://deemoprobe.github.io/posts/tech/dockerimagesoptimization/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-26T18:43:22+08:00" />
<meta property="article:modified_time" content="2023-04-26T18:43:22+08:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="DockerImagesOptimization"/>
<meta name="twitter:description" content="Dockeré•œåƒä½“ç§¯ä¼˜åŒ–"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  1 ,
          "name": "ğŸ“šæ–‡ç« ",
          "item": "https://deemoprobe.github.io/posts/"
        },

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯",
          "item": "https://deemoprobe.github.io/posts/tech/"
        }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "DockerImagesOptimization",
      "item": "https://deemoprobe.github.io/posts/tech/dockerimagesoptimization/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "DockerImagesOptimization",
  "name": "DockerImagesOptimization",
  "description": "Dockeré•œåƒä½“ç§¯ä¼˜åŒ–",
  "keywords": [
    "docker"
  ],
  "articleBody": "ä¼˜åŒ–åŸç† dockeré•œåƒå±‚æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼ˆå’Œé•œåƒå¤§å°æ¯æ¯ç›¸å…³ï¼‰ï¼š\nRUNã€COPY å’Œ ADD æŒ‡ä»¤ä¼šåœ¨å·²æœ‰é•œåƒå±‚çš„åŸºç¡€ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚ï¼Œæ‰§è¡ŒæŒ‡ä»¤äº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿå˜æ›´ä¼šåœ¨æŒ‡ä»¤ç»“æŸåä½œä¸ºä¸€ä¸ªé•œåƒå±‚æ•´ä½“æäº¤ é•œåƒå±‚å…·æœ‰copy-on-writeçš„ç‰¹æ€§ï¼Œå¦‚æœå»æ›´æ–°å…¶ä»–é•œåƒå±‚ä¸­å·²å­˜åœ¨çš„æ–‡ä»¶ï¼Œä¼šå…ˆå°†å…¶å¤åˆ¶åˆ°æ–°çš„é•œåƒå±‚ä¸­å†ä¿®æ”¹ï¼Œé€ æˆåŒå€çš„æ–‡ä»¶ç©ºé—´å ç”¨ å¦‚æœå»åˆ é™¤å…¶ä»–é•œåƒå±‚çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œåªä¼šåœ¨å½“å‰é•œåƒå±‚ç”Ÿæˆä¸€ä¸ªè¯¥æ–‡ä»¶çš„åˆ é™¤æ ‡è®°ï¼Œå¹¶ä¸ä¼šå‡å°‘æ•´ä¸ªé•œåƒçš„å®é™…ä½“ç§¯ [root@centos7 tmp]# cat Dockerfile FROM alpine COPY resource.tar / RUN touch /resource.tar RUN rm -f /resource.tar [root@centos7 tmp]# ls -lh resource.tar -rw-r--r--. 1 root root 9.9M Apr 26 15:46 resource.tar [root@centos7 tmp]# docker build -t demo:v1 . [+] Building 20.3s (9/9) FINISHED =\u003e [internal] load .dockerignore 0.0s =\u003e =\u003e transferring context: 2B 0.0s =\u003e [internal] load build definition from Dockerfile 0.0s =\u003e =\u003e transferring dockerfile: 177B 0.0s =\u003e [internal] load metadata for docker.io/library/alpine:latest 17.5s =\u003e [internal] load build context 0.2s =\u003e =\u003e transferring context: 10.30MB 0.2s =\u003e [1/4] FROM docker.io/library/alpine@sha256:21a3deaa0d32a8057914f36584b5288d2e5ecc984380bc0118285c70fa8c9300 1.6s =\u003e =\u003e resolve docker.io/library/alpine@sha256:21a3deaa0d32a8057914f36584b5288d2e5ecc984380bc0118285c70fa8c9300 0.0s =\u003e =\u003e sha256:21a3deaa0d32a8057914f36584b5288d2e5ecc984380bc0118285c70fa8c9300 1.64kB / 1.64kB 0.0s =\u003e =\u003e sha256:e7d88de73db3d3fd9b2d63aa7f447a10fd0220b7cbf39803c803f2af9ba256b3 528B / 528B 0.0s =\u003e =\u003e sha256:c059bfaa849c4d8e4aecaeb3a10c2d9b3d85f5165c66ad3a4d937758128c4d18 1.47kB / 1.47kB 0.0s =\u003e =\u003e sha256:59bf1c3509f33515622619af21ed55bbe26d24913cedbca106468a5fb37a50c3 2.82MB / 2.82MB 1.2s =\u003e =\u003e extracting sha256:59bf1c3509f33515622619af21ed55bbe26d24913cedbca106468a5fb37a50c3 0.3s =\u003e [2/4] COPY resource.tar / 0.1s =\u003e [3/4] RUN touch /resource.tar 0.4s =\u003e [4/4] RUN rm -f /resource.tar 0.5s =\u003e exporting to image 0.2s =\u003e =\u003e exporting layers 0.2s =\u003e =\u003e writing image sha256:1113b0fb22dabb56b6926960eafd2a6aaf183d1bd2373f1be10df67c73714f37 0.0s =\u003e =\u003e naming to docker.io/library/demo:v1 0.0s [root@centos7 tmp]# docker history demo:v1 IMAGE CREATED CREATED BY SIZE COMMENT 1113b0fb22da 13 seconds ago RUN /bin/sh -c rm -f /resource.tar # buildkit 0B buildkit.dockerfile.v0 13 seconds ago RUN /bin/sh -c touch /resource.tar # buildkit 10.3MB buildkit.dockerfile.v0 14 seconds ago COPY resource.tar / # buildkit 10.3MB buildkit.dockerfile.v0 17 months ago /bin/sh -c #(nop) CMD [\"/bin/sh\"] 0B 17 months ago /bin/sh -c #(nop) ADD file:9233f6f2237d79659â€¦ 5.59MB [root@centos7 tmp]# docker images REPOSITORY TAG IMAGE ID CREATED SIZE demo v1 1113b0fb22da 24 seconds ago 26.2MB ä¸Šé¢ä¾‹å­å¯ä»¥åˆ†æå‡ºï¼šalpineåŸºç¡€é•œåƒå¤§å°+5.59MBï¼Œresource.tar COPYè§£å‹å+10.3MBï¼Œtouchå‘½ä»¤æ‰§è¡Œæ—¶å¤åˆ¶äº†ä¸€ä»½+10.3MBï¼Œrmè™½ç„¶æ˜¾ç¤ºæ–‡ä»¶å¤§å°ä¸º0ï¼Œä½†å®é™…ä¸Šå‰å‡ å±‚çš„é•œåƒä¾ç„¶å­˜åœ¨ã€‚æœ€ç»ˆé•œåƒå¤§å°26.2MBã€‚\né•œåƒåˆ†æ docker history IMAGEï¼šæŸ¥çœ‹IMAGEæ„å»ºè¿‡ç¨‹ï¼Œå±•ç¤ºé•œåƒå±‚ä¿¡æ¯ dive IMAGEï¼šç¬¬ä¸‰æ–¹åˆ†æå·¥å…·ï¼Œåˆ†æé•œåƒå±‚ç»“æ„ï¼Œæ¯å±‚é•œåƒæ‰€åŒ…å«çš„æ–‡ä»¶ä»¥åŠä½“ç§¯ï¼Œæ¯”historyæ›´åŠ è¯¦ç»† diveå®‰è£…å‚è€ƒå®˜æ–¹æ–‡æ¡£\n[root@centos7 go]# dive demo:v1 â”ƒ â— Layers â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ Current Layer Contents â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Cmp Size Command Permission UID:GID Size Filetree 7.0 MB FROM 580fdc606fb93e5 drwxr-xr-x 0:0 841 kB â”œâ”€â”€ bin 10 MB COPY resource.tar / # buildkit -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ arch â†’ /bin/busybox 10 MB RUN /bin/sh -c touch /resource.tar # buildkit -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ ash â†’ /bin/busybox 0 B RUN /bin/sh -c rm -f /resource.tar # buildkit -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ base64 â†’ /bin/busybox -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ bbconfig â†’ /bin/busybox â”‚ Layer Details â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -rwxr-xr-x 0:0 841 kB â”‚ â”œâ”€â”€ busybox -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ cat â†’ /bin/busybox Tags: (unavailable) -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ chattr â†’ /bin/busybox Id: 580fdc606fb93e5fc291e8df154398e0585362a58b8e5b23bfd9d47ca369 -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ chgrp â†’ /bin/busybox 8a79 -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ chmod â†’ /bin/busybox Digest: sha256:f1417ff83b319fbdae6dd9cd6d8c9c88002dcd75ecf6ec201c8c6 -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ chown â†’ /bin/busybox 894681cf2b5 -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ cp â†’ /bin/busybox Command: -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ date â†’ /bin/busybox #(nop) ADD file:9a4f77dfaba7fd2aa78186e4ef0e7486ad55101cefc1fabbc1b3 -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ dd â†’ /bin/busybox 85601bb38920 in / -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ df â†’ /bin/busybox -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ dmesg â†’ /bin/busybox â”‚ Image Details â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ dnsdomainname â†’ /bin/busy -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ dumpkmap â†’ /bin/busybox -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ echo â†’ /bin/busybox Total Image size: 28 MB -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ ed â†’ /bin/busybox Potential wasted space: 21 MB -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ egrep â†’ /bin/busybox Image efficiency score: 25 % -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ false â†’ /bin/busybox -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ fatattr â†’ /bin/busybox Count Total Space Path -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ fdflush â†’ /bin/busybox 3 21 MB /resource.tar -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ fgrep â†’ /bin/busybox 2 0 B /etc -rwxrwxrwx 0:0 0 B â”‚ â”œâ”€â”€ fsync â†’ /bin/busybox ... é•œåƒä¼˜åŒ– é•œåƒï¼ˆä½“ç§¯ï¼‰ä¼˜åŒ–æœ€ä¸»è¦çš„ç›®çš„æ˜¯æ–¹ä¾¿é•œåƒæ›´å¿«é€Ÿæ‹‰å–å’Œåˆ†å‘ï¼ŒåŒæ—¶èŠ‚çœç¡¬ç›˜ç©ºé—´ï¼Œæå‡éƒ¨ç½²æ•ˆç‡ï¼Œä¼˜åŒ–æ–¹å¼å¯ä»¥ä»ä¸‹é¢å‡ ä¸ªæ–¹å¼å…¥æ‰‹ï¼š\nä¼˜åŒ–åŸºç¡€é•œåƒï¼Œåœ¨ä¸å½±å“ä¸šåŠ¡ç»´æŠ¤çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½ä½¿ç”¨æ›´å°çš„åŸºç¡€é•œåƒï¼Œå¦‚ï¼šalpineæˆ–image:alpine ä¼˜åŒ–Dockerfileä¸­æŒ‡ä»¤ï¼Œå¦‚å¤šæ¡RUNæŒ‡ä»¤\u0026\u0026ä¸²è”å†™åœ¨åŒä¸€è¡Œï¼Œä½¿ä¹‹ä»…ç”Ÿæˆä¸€å±‚é•œåƒï¼Œé˜²æ­¢åˆ†å±‚è¿‡å¤š ä½¿ç”¨--squashå‚æ•°å‹ç¼©é•œåƒå±‚ï¼Œå®˜æ–¹æç¤ºå·²å¼ƒç”¨ï¼ˆæœ¬äººç›®å‰ç‰ˆæœ¬æ˜¯23.0.4ï¼‰ å¤šé˜¶æ®µæ„å»ºï¼Œæ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹å®˜ç½‘ä»‹ç» æ ¹æ®diveåˆ†æç»“æœä¼˜åŒ– å¯¹äºåŸºç¡€é•œåƒï¼ˆæœ€åº•å±‚ï¼‰å¤§äº500MBçš„ï¼Œå»ºè®®é€‰æ‹©æ›´å°çš„åŸºç¡€é•œåƒï¼Œå¦‚åŸºäºalpineçš„é•œåƒ å¯¹äºåˆ†å±‚å¤§äº10å±‚çš„é•œåƒï¼Œè·å–å„å±‚çš„å‘½ä»¤æ±‡æ€»å±•ç¤ºï¼Œå»ºè®®è°ƒæ•´æŒ‡ä»¤ï¼Œæ˜¯å¦å·²ä½¿ç”¨ä¸²è¿çš„å½¢å¼ é¿å…äº§ç”Ÿæ— ç”¨çš„ç¼“å­˜ï¼Œå¦‚pipåº”ä½¿ç”¨--no-cache-dirç¦ç”¨ç¼“å­˜ï¼Œyum makecacheä¹Ÿä¼šäº§ç”Ÿç¼“å­˜ é¿å…æ— ç”¨æ–‡ä»¶ï¼ˆ.md .pdf .txt .docç­‰ä¸€äº›æ–‡æ¡£æ–‡ä»¶ä¸åº”è¯¥å‡ºç°åœ¨é•œåƒä¸­ï¼‰ é¿å…å®‰è£…å¤šä½™çš„è½¯ä»¶ # å…ˆæ‹‰å–é•œåƒåˆ°æœ¬åœ°ï¼ŒåŠ å¿«åé¢çš„æ„å»ºé€Ÿåº¦ docker pull centos:latest docker pull alpine:latest docker pull golang:latest docker pull ubuntu:latest docker pull fedora:28 ä¼˜åŒ–åŸºç¡€é•œåƒ [root@centos7 base]# pwd /root/dockerfile/base [root@centos7 base]# cat Dockerfile FROM centos CMD [\"echo\", \"hi\"] [root@centos7 base]# docker build -t base:v1 . # ä¿®æ”¹åŸºç¡€é•œåƒ [root@centos7 base]# cat Dockerfile FROM alpine CMD [\"echo\", \"hi\"] [root@centos7 base]# docker build -t base:v2 . [root@centos7 base]# docker images | grep base base v2 025106dd85eb 4 weeks ago 7.05MB base v1 108460ab34b0 19 months ago 231MB ä¸²è”å‘½ä»¤ [root@centos7 multirun]# pwd /root/dockerfile/multirun [root@centos7 multirun]# cat Dockerfile FROM fedora:28 RUN dnf install -y nginx RUN dnf clean all RUN rm -rf /var/cache/yum [root@centos7 multirun]# docker build -t multirun:v1 . # åˆ†æé•œåƒ [root@centos7 multirun]# docker images| grep mul multirun v1 2666d7aa527a 2 minutes ago 488MB [root@centos7 multirun]# docker history multirun:v1 IMAGE CREATED CREATED BY SIZE COMMENT 2666d7aa527a 17 seconds ago RUN /bin/sh -c rm -rf /var/cache/yum # buildâ€¦ 0B buildkit.dockerfile.v0 18 seconds ago RUN /bin/sh -c dnf clean all # buildkit 1.79MB buildkit.dockerfile.v0 19 seconds ago RUN /bin/sh -c dnf install -y nginx # buildkâ€¦ 226MB buildkit.dockerfile.v0 4 years ago /bin/sh -c #(nop) CMD [\"/bin/bash\"] 0B 4 years ago /bin/sh -c #(nop) ADD file:42ddab590052fda98â€¦ 261MB 4 years ago /bin/sh -c #(nop) ENV DISTTAG=f28container â€¦ 0B 4 years ago /bin/sh -c #(nop) LABEL maintainer=Clement â€¦ 0B [root@centos7 multirun]# dive multirun:v1 â”ƒ â— Layers â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ Current Layer Contents â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Cmp Size Command Permission UID:GID Size Filetree 260 MB FROM 9bfbc900bde2f55 -rwxrwxrwx 0:0 0 B â”œâ”€â”€ bin â†’ usr/bin 226 MB RUN /bin/sh -c dnf install -y nginx # buildkit dr-xr-xr-x 0:0 0 B â”œâ”€â”€ boot 1.8 MB RUN /bin/sh -c dnf clean all # buildkit drwxr-xr-x 0:0 0 B â”œâ”€â”€ dev 0 B RUN /bin/sh -c rm -rf /var/cache/yum # buildkit drwxr-xr-x 0:0 1.8 MB â”œâ”€â”€ etc -rw------- 0:0 0 B â”‚ â”œâ”€â”€ .pwd.lock â”‚ Layer Details â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -rw-r--r-- 0:0 4.5 kB â”‚ â”œâ”€â”€ DIR_COLORS -rw-r--r-- 0:0 5.2 kB â”‚ â”œâ”€â”€ DIR_COLORS.256color Tags: (unavailable) -rw-r--r-- 0:0 4.6 kB â”‚ â”œâ”€â”€ DIR_COLORS.lightbgcolor Id: 9bfbc900bde2f55fafbeeed2be52e80c9b06244dee226dc54a354f9d09ea -rw-r--r-- 0:0 94 B â”‚ â”œâ”€â”€ GREP_COLORS 1910 drwxr-xr-x 0:0 203 B â”‚ â”œâ”€â”€ X11 Digest: sha256:17beab58d693a5e55591675c3dcc5b575a44e476d125408102ce7 drwxr-xr-x 0:0 0 B â”‚ â”‚ â”œâ”€â”€ applnk 5348011f807 drwxr-xr-x 0:0 0 B â”‚ â”‚ â”œâ”€â”€ fontpath.d Command: drwxr-xr-x 0:0 203 B â”‚ â”‚ â”œâ”€â”€ xinit #(nop) ADD file:42ddab590052fda98865a9ecd9dc28c8d3ba7922a6d21b1f182a drwxr-xr-x 0:0 203 B â”‚ â”‚ â”‚ â””â”€â”€ xinitrc.d 0a3769419677 in / -rwxr-xr-x 0:0 203 B â”‚ â”‚ â”‚ â””â”€â”€ 50-systemd-us drwxr-xr-x 0:0 0 B â”‚ â”‚ â””â”€â”€ xorg.conf.d â”‚ Image Details â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -rw-r--r-- 0:0 16 B â”‚ â”œâ”€â”€ adjtime -rw-r--r-- 0:0 1.5 kB â”‚ â”œâ”€â”€ aliases drwxr-xr-x 0:0 0 B â”‚ â”œâ”€â”€ alternatives Total Image size: 488 MB -rwxrwxrwx 0:0 0 B â”‚ â”‚ â”œâ”€â”€ cifs-idmap-plugin â†’ / Potential wasted space: 234 MB -rwxrwxrwx 0:0 0 B â”‚ â”‚ â””â”€â”€ libnssckbi.so.x86_64 Image efficiency score: 54 % drwxr-xr-x 0:0 0 B â”‚ â”œâ”€â”€ bash_completion.d -rw-r--r-- 0:0 3.0 kB â”‚ â”œâ”€â”€ bashrc Count Total Space Path drwxr-xr-x 0:0 0 B â”‚ â”œâ”€â”€ binfmt.d 2 48 MB /var/cache/dnf/fedora-filenames.solvx drwxr-xr-x 0:0 0 B â”‚ â”œâ”€â”€ chkconfig.d 2 47 MB /var/cache/dnf/fedora-f21308f6293b3270/repodata drwxr-xr-x 0:0 0 B â”‚ â”œâ”€â”€ cifs-utils /a53009478e29c551710df570a5dc726ce5160300c7c1ecde852895ab8a6fcf72-fi -rwxrwxrwx 0:0 0 B â”‚ â”‚ â””â”€â”€ idmap-plugin â†’ /etc/a lelists.xml.gz drwxr-xr-x 0:0 614 B â”‚ â”œâ”€â”€ crypto-policies 2 24 MB /var/cache/dnf/updates-filenames.solvx drwxr-xr-x 0:0 0 B â”‚ â”‚ â”œâ”€â”€ back-ends 2 23 MB /var/cache/dnf/updates-8bd9ef368505a5fd/repodat -rwxrwxrwx 0:0 0 B â”‚ â”‚ â”‚ â”œâ”€â”€ bind.config â†’ /us a/15dc5106b1b18f200a2f520b561e59fd8a75d921acfd7edf34e8d88db3b9220a-f -rwxrwxrwx 0:0 0 B â”‚ â”‚ â”‚ â”œâ”€â”€ gnutls.config â†’ / ilelists.xml.gz -rwxrwxrwx 0:0 0 B â”‚ â”‚ â”‚ â”œâ”€â”€ java.config â†’ /us 2 21 MB /var/cache/dnf/fedora.solv -rwxrwxrwx 0:0 0 B â”‚ â”‚ â”‚ â”œâ”€â”€ krb5.config â†’ /us 2 18 MB /var/lib/rpm/Packages -rwxrwxrwx 0:0 0 B â”‚ â”‚ â”‚ â”œâ”€â”€ libreswan.config 2 16 MB /var/cache/dnf/fedora-f21308f6293b3270/repodata -rwxrwxrwx 0:0 0 B â”‚ â”‚ â”‚ â”œâ”€â”€ nss.config â†’ /usr /9659dfc44de50563682658fd41f2ab0da60e5657e1cc4f598b50d39fb3436e0c-pr -rwxrwxrwx 0:0 0 B â”‚ â”‚ â”‚ â”œâ”€â”€ openssh.config â†’ ... # ä»diveåˆ†æç»“æœå¯ä»¥çœ‹å‡ºä¸ä½†æ¯ä¸ªRUNéƒ½äº§ç”Ÿäº†ä¸€å±‚é•œåƒï¼Œè€Œä¸”å®é™…ä¸Šç¼“å­˜å¹¶æ²¡æœ‰æ¸…ç†æ‰ï¼Œæç¤ºPotential wasted space: 234 MBï¼Œæ½œåœ¨æµªè´¹äº†234MBç©ºé—´ # ä¼˜åŒ–RUNå‘½ä»¤ [root@centos7 multirun]# cat Dockerfile FROM fedora:28 RUN dnf install -y nginx\\ \u0026\u0026 dnf clean all\\ \u0026\u0026 rm -rf /var/cache/yum [root@centos7 multirun]# docker build -t multirun:v2 . [root@centos7 multirun]# dive multirun:v2 â”ƒ â— Layers â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ Current Layer Contents â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Cmp Size Command Permission UID:GID Size Filetree 260 MB FROM 9bfbc900bde2f55 -rwxrwxrwx 0:0 0 B â”œâ”€â”€ bin â†’ usr/bin 18 MB RUN /bin/sh -c dnf install -y nginx \u0026\u0026 dnf clean all \u0026\u0026 dr-xr-xr-x 0:0 0 B â”œâ”€â”€ boot drwxr-xr-x 0:0 0 B â”œâ”€â”€ dev â”‚ Layer Details â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ drwxr-xr-x 0:0 1.8 MB â”œâ”€â”€ etc -rw------- 0:0 0 B â”‚ â”œâ”€â”€ .pwd.lock Tags: (unavailable) -rw-r--r-- 0:0 4.5 kB â”‚ â”œâ”€â”€ DIR_COLORS Id: 9bfbc900bde2f55fafbeeed2be52e80c9b06244dee226dc54a354f9d09ea -rw-r--r-- 0:0 5.2 kB â”‚ â”œâ”€â”€ DIR_COLORS.256color 1910 -rw-r--r-- 0:0 4.6 kB â”‚ â”œâ”€â”€ DIR_COLORS.lightbgcolor Digest: sha256:17beab58d693a5e55591675c3dcc5b575a44e476d125408102ce7 -rw-r--r-- 0:0 94 B â”‚ â”œâ”€â”€ GREP_COLORS 5348011f807 drwxr-xr-x 0:0 203 B â”‚ â”œâ”€â”€ X11 Command: drwxr-xr-x 0:0 0 B â”‚ â”‚ â”œâ”€â”€ applnk #(nop) ADD file:42ddab590052fda98865a9ecd9dc28c8d3ba7922a6d21b1f182a drwxr-xr-x 0:0 0 B â”‚ â”‚ â”œâ”€â”€ fontpath.d 0a3769419677 in / drwxr-xr-x 0:0 203 B â”‚ â”‚ â”œâ”€â”€ xinit drwxr-xr-x 0:0 203 B â”‚ â”‚ â”‚ â””â”€â”€ xinitrc.d â”‚ Image Details â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -rwxr-xr-x 0:0 203 B â”‚ â”‚ â”‚ â””â”€â”€ 50-systemd-us drwxr-xr-x 0:0 0 B â”‚ â”‚ â””â”€â”€ xorg.conf.d -rw-r--r-- 0:0 16 B â”‚ â”œâ”€â”€ adjtime Total Image size: 278 MB -rw-r--r-- 0:0 1.5 kB â”‚ â”œâ”€â”€ aliases Potential wasted space: 24 MB drwxr-xr-x 0:0 0 B â”‚ â”œâ”€â”€ alternatives Image efficiency score: 95 % -rwxrwxrwx 0:0 0 B â”‚ â”‚ â”œâ”€â”€ cifs-idmap-plugin â†’ / -rwxrwxrwx 0:0 0 B â”‚ â”‚ â””â”€â”€ libnssckbi.so.x86_64 Count Total Space Path drwxr-xr-x 0:0 0 B â”‚ â”œâ”€â”€ bash_completion.d 2 18 MB /var/lib/rpm/Packages -rw-r--r-- 0:0 3.0 kB â”‚ â”œâ”€â”€ bashr ... # ç¼“å­˜å·²æ¸…ç†å¹²å‡€ï¼Œæœ‰æ•ˆç©ºé—´å æ¯”95%ï¼ŒImage efficiency score: 95 % å‹ç¼©é•œåƒå±‚ï¼ˆå¼ƒç”¨ï¼‰ docker1.13ç‰ˆæœ¬åå¯ä»¥ç›´æ¥ä½¿ç”¨--squashå‚æ•°å‹ç¼©é•œåƒå±‚ï¼Œä¹‹å‰éœ€è¦å•ç‹¬å®‰è£…docker-squashå·¥å…·æ‰èƒ½å®ç°ã€‚ä½†ç›®å‰å·²ç§»é™¤äº†è¿™ä¸ªå‚æ•°ï¼Œä½¿ç”¨ä¹Ÿæ— æ•ˆã€‚\n# ä¾æ—§ä»¥ä¸Šé¢RUNä¸ºä¾‹ [root@centos7 squash]# pwd /root/dockerfile/squash [root@centos7 squash]# cat Dockerfile FROM fedora:28 RUN dnf install -y nginx RUN dnf clean all RUN rm -rf /var/cache/yum [root@centos7 squash]# docker build -t squash:v1 . # å‹ç¼©å‰488MB [root@centos7 squash]# docker images | grep squ squash v1 2666d7aa527a 45 minutes ago 488MB # å‘ç°æç¤ºå·²ç§»é™¤è¯¥å‚æ•°ï¼Œæç¤ºä½¿ç”¨å¤šé˜¶æ®µæ„å»º [root@centos7 squash]# docker build -t squash:v2 --squash . WARNING: experimental flag squash is removed with BuildKit. You should squash inside build using a multi-stage Dockerfile for efficiency. [root@centos7 squash]# docker images | grep squ squash v1 2666d7aa527a 46 minutes ago 488MB squash v2 2666d7aa527a 46 minutes ago 488MB [root@centos7 squash]# docker version Client: Docker Engine - Community Version: 23.0.4 ... æ—¢ç„¶å®˜æ–¹å·²å¼ƒç”¨ï¼Œé‚£å°±ä¸è¯¦ç»†ç ”ç©¶äº†ã€‚å»ºè®®ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºã€‚åŸæœ¬é•œåƒå±‚å‹ç¼©å°±ä¼šé€ æˆå…¶ä»–ç¼“å­˜å±‚æ— æ³•å…±ç”¨ï¼Œå¤±å»äº†é•œåƒçš„ä¼˜åŠ¿ï¼Œåœ¨é•œåƒè¾ƒå¤šçš„æƒ…å†µä¸‹æ— æ³•å…¬ç”¨ï¼Œå­˜å‚¨å¼€é”€æ˜¯å¾ˆå¤§çš„ã€‚\nå¤šé˜¶æ®µæ„å»º scratchæ˜¯ä¸€ä¸ªç©ºé•œåƒï¼Œä¸èƒ½æ‹‰å–ä¹Ÿä¸èƒ½è¿è¡Œï¼Œé‡Œé¢ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œä½†å¯ä»¥ä½œä¸ºåŸºç¡€é•œåƒæ„å»ºå…¶ä»–é•œåƒã€‚\n[root@centos7 go]# pwd /root/dockerfile/go [root@centos7 go]# cat hello.go package main import \"fmt\" func main() { fmt.Println(\"hello world.\") } [root@centos7 go]# cat Dockerfile FROM golang COPY hello.go . RUN go build hello.go CMD [\"./hello\"] [root@centos7 go]# docker run -it --rm go:v1 hello world. # åˆ†é˜¶æ®µæ„å»ºï¼Œè¿™é‡ŒæŒ‡å®šWORKDIRï¼Œæ–¹ä¾¿å¤åˆ¶å¯æ‰§è¡Œæ–‡ä»¶ [root@centos7 go]# cat Dockerfile FROM golang AS first WORKDIR /app COPY hello.go . RUN go build hello.go FROM scratch COPY --from=first /app/hello . CMD [\"./hello\"] [root@centos7 go]# docker build -t go:v2 . [root@centos7 go]# docker run -it --rm go:v2 hello world. [root@centos7 go]# docker images | grep go go v2 d9e76072de38 29 seconds ago 1.85MB go v1 c5bb11851550 2 minutes ago 804MB # ä½¿ç”¨éscratché•œåƒ [root@centos7 go]# cat Dockerfile FROM golang WORKDIR /app COPY hello.go . RUN go build hello.go FROM ubuntu COPY --from=0 /app/hello . CMD [\"./hello\"] [root@centos7 go]# docker build -t go:v3 . [root@centos7 go]# docker images | grep v3 go v3 d1429ea70f10 13 seconds ago 74.6MB æ³¨æ„åˆ°åˆ†é˜¶æ®µæ„å»ºæ—¶ç”¨äº†--from=firstå’Œ--from=0ã€‚--from=0è¡¨ç¤ºFROMæŒ‰åºå·ç®—ï¼ˆä»0å¼€å§‹ï¼‰çš„é˜¶æ®µï¼Œå¯ä»¥ä¸å¿…æŒ‡å®šAS build_nameï¼›--from=firstè¿™é‡Œçš„firstå°±æ˜¯æ„å»ºé˜¶æ®µçš„åˆ«åï¼Œç”¨ASæŒ‡å®šåˆ«åï¼Œä»¥ä¾›è°ƒç”¨ã€‚\nä¼˜åŒ–æ³¨æ„äº‹é¡¹ scratché•œåƒï¼šè¯¥é•œåƒä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œæ²¡æœ‰shellï¼Œæ²¡æœ‰ç¨‹åºé“¾æ¥åº“ï¼ˆåº“æ–‡ä»¶ï¼‰ï¼Œæ²¡æœ‰è°ƒè¯•å·¥å…·ï¼ˆps/top/pingç­‰ï¼‰ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦è¿™äº›åŠŸèƒ½ï¼Œä¸æ¨èä½¿ç”¨scratché•œåƒï¼Œå¯ä»¥é€‰ç”¨åˆé€‚çš„é•œåƒæ„å»ºï¼Œå¦‚ï¼šbusyboxã€alpineã€ubuntuç­‰\nalpineé•œåƒï¼šè¯¥é•œåƒæ ‡å‡†åº“æ˜¯musl libcè€Œä¸æ˜¯glibcï¼Œç¨‹åºä¾èµ–glibcåº“æ—¶ï¼Œåœ¨alpineä¸­ç¼–è¯‘æ—¶ä¼šå› ä¸ºåº“ç¼ºå¤±è€ŒæŠ¥é”™ã€‚é™¤äº†æ ‡å‡†åº“ï¼Œalpineå¯¹æ–‡ä»¶ç³»ç»Ÿä¹Ÿè¿›è¡Œäº†ç²¾ç®€ï¼ŒPythonç¨‹åºåœ¨alpineä¸­è¿è¡Œæ•ˆç‡éå¸¸ä½ï¼Œæ‰€ä»¥è°¨æ…ä½¿ç”¨ï¼Œå¯ä»¥é€‰æ‹©å…¶ä»–åˆé€‚é•œåƒæ„å»ºï¼Œå¦‚ï¼šbusybox:glibcã€ubuntuã€debian-slimå’Œopenjdk:8-jre-alpineï¼Œå¾ˆå¤šé•œåƒå‘å¸ƒäº†è‡ªå·±å¾—alpineç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨\nç”Ÿäº§ä¸­æ˜¯å¦ä½¿ç”¨alpineé•œåƒå¯ä»¥å‚è€ƒæ–‡ç« ï¼šalpineé•œåƒåˆ†æ\né•œåƒç²¾ç®€å›ºç„¶é‡è¦ï¼Œä½†å¦‚æœä»¥æå‡ç¨‹åºå¤æ‚åº¦ä¸ºä»£ä»·æ˜¯ä¸å¦¥çš„ã€‚\né’ˆå¯¹ä¸åŒå¼€å‘è¯­è¨€çš„é•œåƒç²¾ç®€ç­–ç•¥å¯ä»¥å‚è€ƒæ–‡ç« ï¼šDocker é•œåƒåˆ¶ä½œæ•™ç¨‹ï¼šé’ˆå¯¹ä¸åŒè¯­è¨€çš„ç²¾ç®€ç­–ç•¥\n",
  "wordCount" : "4464",
  "inLanguage": "en",
  "datePublished": "2023-04-26T18:43:22+08:00",
  "dateModified": "2023-04-26T18:43:22+08:00",
  "author":[{
    "@type": "Person",
    "name": "deemoprobe"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://deemoprobe.github.io/posts/tech/dockerimagesoptimization/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "William's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://deemoprobe.github.io/img/bear.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://deemoprobe.github.io/" accesskey="h" title="William&#39;s Blog (Alt + H)">
            <img src="https://deemoprobe.github.io/img/bear.gif" alt="logo" aria-label="logo"
                 height="35">William&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://deemoprobe.github.io/" title="ğŸ  ä¸»é¡µ">
                <span>ğŸ  ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://deemoprobe.github.io/tags" title="ğŸ§© æ ‡ç­¾">
                <span>ğŸ§© æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://deemoprobe.github.io/archives/" title="ğŸ“ˆ å½’æ¡£">
                <span>ğŸ“ˆ å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="https://deemoprobe.github.io/tools" title="ğŸ§± å·¥å…·">
                <span>ğŸ§± å·¥å…·</span>
                </a>
            </li>
            <li>
                <a href="https://deemoprobe.github.io/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                <span>ğŸ” æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            
            <h1 class="post-title">
                DockerImagesOptimization
            </h1>
            <div class="post-description">
                Dockeré•œåƒä½“ç§¯ä¼˜åŒ–
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-04-26
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>4464å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>9åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>deemoprobe
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://deemoprobe.github.io/tags/docker/" style="color: var(--secondary)!important;">docker</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    
                </span>

</div>
        </header> <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">æ–‡ç« ç›®å½•</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#%e4%bc%98%e5%8c%96%e5%8e%9f%e7%90%86" aria-label="ä¼˜åŒ–åŸç†">ä¼˜åŒ–åŸç†</a></li>
                <li>
                    <a href="#%e9%95%9c%e5%83%8f%e5%88%86%e6%9e%90" aria-label="é•œåƒåˆ†æ">é•œåƒåˆ†æ</a></li>
                <li>
                    <a href="#%e9%95%9c%e5%83%8f%e4%bc%98%e5%8c%96" aria-label="é•œåƒä¼˜åŒ–">é•œåƒä¼˜åŒ–</a><ul>
                        
                <li>
                    <a href="#%e4%bc%98%e5%8c%96%e5%9f%ba%e7%a1%80%e9%95%9c%e5%83%8f" aria-label="ä¼˜åŒ–åŸºç¡€é•œåƒ">ä¼˜åŒ–åŸºç¡€é•œåƒ</a></li>
                <li>
                    <a href="#%e4%b8%b2%e8%81%94%e5%91%bd%e4%bb%a4" aria-label="ä¸²è”å‘½ä»¤">ä¸²è”å‘½ä»¤</a></li>
                <li>
                    <a href="#%e5%8e%8b%e7%bc%a9%e9%95%9c%e5%83%8f%e5%b1%82%e5%bc%83%e7%94%a8" aria-label="å‹ç¼©é•œåƒå±‚ï¼ˆå¼ƒç”¨ï¼‰">å‹ç¼©é•œåƒå±‚ï¼ˆå¼ƒç”¨ï¼‰</a></li>
                <li>
                    <a href="#%e5%a4%9a%e9%98%b6%e6%ae%b5%e6%9e%84%e5%bb%ba" aria-label="å¤šé˜¶æ®µæ„å»º">å¤šé˜¶æ®µæ„å»º</a></li>
                <li>
                    <a href="#%e4%bc%98%e5%8c%96%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9" aria-label="ä¼˜åŒ–æ³¨æ„äº‹é¡¹">ä¼˜åŒ–æ³¨æ„äº‹é¡¹</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;
        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        <div class="post-content"><h2 id="ä¼˜åŒ–åŸç†">ä¼˜åŒ–åŸç†<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–åŸç†">#</a></h2>
<p>dockeré•œåƒå±‚æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼ˆå’Œé•œåƒå¤§å°æ¯æ¯ç›¸å…³ï¼‰ï¼š</p>
<ul>
<li><code>RUN</code>ã€<code>COPY</code> å’Œ <code>ADD</code> æŒ‡ä»¤ä¼šåœ¨å·²æœ‰é•œåƒå±‚çš„åŸºç¡€ä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„é•œåƒå±‚ï¼Œæ‰§è¡ŒæŒ‡ä»¤äº§ç”Ÿçš„æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿå˜æ›´ä¼šåœ¨æŒ‡ä»¤ç»“æŸåä½œä¸ºä¸€ä¸ªé•œåƒå±‚æ•´ä½“æäº¤</li>
<li>é•œåƒå±‚å…·æœ‰<code>copy-on-write</code>çš„ç‰¹æ€§ï¼Œå¦‚æœå»æ›´æ–°å…¶ä»–é•œåƒå±‚ä¸­å·²å­˜åœ¨çš„æ–‡ä»¶ï¼Œä¼šå…ˆå°†å…¶å¤åˆ¶åˆ°æ–°çš„é•œåƒå±‚ä¸­å†ä¿®æ”¹ï¼Œé€ æˆåŒå€çš„æ–‡ä»¶ç©ºé—´å ç”¨</li>
<li>å¦‚æœå»åˆ é™¤å…¶ä»–é•œåƒå±‚çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œåªä¼šåœ¨å½“å‰é•œåƒå±‚ç”Ÿæˆä¸€ä¸ªè¯¥æ–‡ä»¶çš„åˆ é™¤æ ‡è®°ï¼Œå¹¶ä¸ä¼šå‡å°‘æ•´ä¸ªé•œåƒçš„å®é™…ä½“ç§¯</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 tmp<span style="color:#f92672">]</span><span style="color:#75715e"># cat Dockerfile</span>
</span></span><span style="display:flex;"><span>FROM alpine
</span></span><span style="display:flex;"><span>COPY resource.tar /
</span></span><span style="display:flex;"><span>RUN touch /resource.tar
</span></span><span style="display:flex;"><span>RUN rm -f /resource.tar
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 tmp<span style="color:#f92672">]</span><span style="color:#75715e"># ls -lh resource.tar</span>
</span></span><span style="display:flex;"><span>-rw-r--r--. <span style="color:#ae81ff">1</span> root root 9.9M Apr <span style="color:#ae81ff">26</span> 15:46 resource.tar
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 tmp<span style="color:#f92672">]</span><span style="color:#75715e"># docker build -t demo:v1 .</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>+<span style="color:#f92672">]</span> Building 20.3s <span style="color:#f92672">(</span>9/9<span style="color:#f92672">)</span> FINISHED
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>internal<span style="color:#f92672">]</span> load .dockerignore                                                                                                   0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; transferring context: 2B                                                                                                     0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>internal<span style="color:#f92672">]</span> load build definition from Dockerfile                                                                                0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; transferring dockerfile: 177B                                                                                                0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>internal<span style="color:#f92672">]</span> load metadata <span style="color:#66d9ef">for</span> docker.io/library/alpine:latest                                                                   17.5s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>internal<span style="color:#f92672">]</span> load build context                                                                                                   0.2s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; transferring context: 10.30MB                                                                                                0.2s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>1/4<span style="color:#f92672">]</span> FROM docker.io/library/alpine@sha256:21a3deaa0d32a8057914f36584b5288d2e5ecc984380bc0118285c70fa8c9300                     1.6s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; resolve docker.io/library/alpine@sha256:21a3deaa0d32a8057914f36584b5288d2e5ecc984380bc0118285c70fa8c9300                     0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; sha256:21a3deaa0d32a8057914f36584b5288d2e5ecc984380bc0118285c70fa8c9300 1.64kB / 1.64kB                                      0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; sha256:e7d88de73db3d3fd9b2d63aa7f447a10fd0220b7cbf39803c803f2af9ba256b3 528B / 528B                                          0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; sha256:c059bfaa849c4d8e4aecaeb3a10c2d9b3d85f5165c66ad3a4d937758128c4d18 1.47kB / 1.47kB                                      0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; sha256:59bf1c3509f33515622619af21ed55bbe26d24913cedbca106468a5fb37a50c3 2.82MB / 2.82MB                                      1.2s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; extracting sha256:59bf1c3509f33515622619af21ed55bbe26d24913cedbca106468a5fb37a50c3                                           0.3s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>2/4<span style="color:#f92672">]</span> COPY resource.tar /                                                                                                       0.1s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>3/4<span style="color:#f92672">]</span> RUN touch /resource.tar                                                                                                   0.4s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">[</span>4/4<span style="color:#f92672">]</span> RUN rm -f /resource.tar                                                                                                   0.5s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; exporting to image                                                                                                              0.2s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; exporting layers                                                                                                             0.2s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; writing image sha256:1113b0fb22dabb56b6926960eafd2a6aaf183d1bd2373f1be10df67c73714f37                                        0.0s
</span></span><span style="display:flex;"><span> <span style="color:#f92672">=</span>&gt; <span style="color:#f92672">=</span>&gt; naming to docker.io/library/demo:v1                                                                                          0.0s
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 tmp<span style="color:#f92672">]</span><span style="color:#75715e"># docker history demo:v1</span>
</span></span><span style="display:flex;"><span>IMAGE          CREATED          CREATED BY                                      SIZE      COMMENT
</span></span><span style="display:flex;"><span>1113b0fb22da   <span style="color:#ae81ff">13</span> seconds ago   RUN /bin/sh -c rm -f /resource.tar <span style="color:#75715e"># buildkit   0B        buildkit.dockerfile.v0</span>
</span></span><span style="display:flex;"><span>&lt;missing&gt;      <span style="color:#ae81ff">13</span> seconds ago   RUN /bin/sh -c touch /resource.tar <span style="color:#75715e"># buildkit   10.3MB    buildkit.dockerfile.v0</span>
</span></span><span style="display:flex;"><span>&lt;missing&gt;      <span style="color:#ae81ff">14</span> seconds ago   COPY resource.tar / <span style="color:#75715e"># buildkit                  10.3MB    buildkit.dockerfile.v0</span>
</span></span><span style="display:flex;"><span>&lt;missing&gt;      <span style="color:#ae81ff">17</span> months ago    /bin/sh -c <span style="color:#75715e">#(nop)  CMD [&#34;/bin/sh&#34;]              0B</span>
</span></span><span style="display:flex;"><span>&lt;missing&gt;      <span style="color:#ae81ff">17</span> months ago    /bin/sh -c <span style="color:#75715e">#(nop) ADD file:9233f6f2237d79659â€¦   5.59MB</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 tmp<span style="color:#f92672">]</span><span style="color:#75715e"># docker images</span>
</span></span><span style="display:flex;"><span>REPOSITORY   TAG       IMAGE ID       CREATED          SIZE
</span></span><span style="display:flex;"><span>demo         v1        1113b0fb22da   <span style="color:#ae81ff">24</span> seconds ago   26.2MB
</span></span></code></pre></div><p>ä¸Šé¢ä¾‹å­å¯ä»¥åˆ†æå‡ºï¼šalpineåŸºç¡€é•œåƒå¤§å°+5.59MBï¼Œresource.tar COPYè§£å‹å+10.3MBï¼Œtouchå‘½ä»¤æ‰§è¡Œæ—¶å¤åˆ¶äº†ä¸€ä»½+10.3MBï¼Œrmè™½ç„¶æ˜¾ç¤ºæ–‡ä»¶å¤§å°ä¸º0ï¼Œä½†å®é™…ä¸Šå‰å‡ å±‚çš„é•œåƒä¾ç„¶å­˜åœ¨ã€‚æœ€ç»ˆé•œåƒå¤§å°26.2MBã€‚</p>
<h2 id="é•œåƒåˆ†æ">é•œåƒåˆ†æ<a hidden class="anchor" aria-hidden="true" href="#é•œåƒåˆ†æ">#</a></h2>
<ul>
<li><code>docker history IMAGE</code>ï¼šæŸ¥çœ‹IMAGEæ„å»ºè¿‡ç¨‹ï¼Œå±•ç¤ºé•œåƒå±‚ä¿¡æ¯</li>
<li><code>dive IMAGE</code>ï¼šç¬¬ä¸‰æ–¹åˆ†æå·¥å…·ï¼Œåˆ†æé•œåƒå±‚ç»“æ„ï¼Œæ¯å±‚é•œåƒæ‰€åŒ…å«çš„æ–‡ä»¶ä»¥åŠä½“ç§¯ï¼Œæ¯”historyæ›´åŠ è¯¦ç»†</li>
</ul>
<p><a href="https://github.com/wagoodman/dive#installation"  target="_blank" rel="noopener" style="color:#42b983" ;>diveå®‰è£…å‚è€ƒå®˜æ–¹æ–‡æ¡£</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 go<span style="color:#f92672">]</span><span style="color:#75715e"># dive demo:v1</span>
</span></span><span style="display:flex;"><span>â”ƒ â— Layers â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ Current Layer Contents â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</span></span><span style="display:flex;"><span>Cmp   Size  Command                                                  Permission     UID:GID       Size  Filetree
</span></span><span style="display:flex;"><span>    7.0 MB  FROM 580fdc606fb93e5                                     drwxr-xr-x         0:0     <span style="color:#ae81ff">841</span> kB  â”œâ”€â”€ bin
</span></span><span style="display:flex;"><span>     <span style="color:#ae81ff">10</span> MB  COPY resource.tar / <span style="color:#75715e"># buildkit                           -rwxrwxrwx         0:0        0 B  â”‚   â”œâ”€â”€ arch â†’ /bin/busybox</span>
</span></span><span style="display:flex;"><span>     <span style="color:#ae81ff">10</span> MB  RUN /bin/sh -c touch /resource.tar <span style="color:#75715e"># buildkit            -rwxrwxrwx         0:0        0 B  â”‚   â”œâ”€â”€ ash â†’ /bin/busybox</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">0</span> B  RUN /bin/sh -c rm -f /resource.tar <span style="color:#75715e"># buildkit            -rwxrwxrwx         0:0        0 B  â”‚   â”œâ”€â”€ base64 â†’ /bin/busybox</span>
</span></span><span style="display:flex;"><span>                                                                     -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ bbconfig â†’ /bin/busybox
</span></span><span style="display:flex;"><span>â”‚ Layer Details â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -rwxr-xr-x         0:0     <span style="color:#ae81ff">841</span> kB  â”‚   â”œâ”€â”€ busybox
</span></span><span style="display:flex;"><span>                                                                     -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ cat â†’ /bin/busybox
</span></span><span style="display:flex;"><span>Tags:   <span style="color:#f92672">(</span>unavailable<span style="color:#f92672">)</span>                                                -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ chattr â†’ /bin/busybox
</span></span><span style="display:flex;"><span>Id:     580fdc606fb93e5fc291e8df154398e0585362a58b8e5b23bfd9d47ca369 -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ chgrp â†’ /bin/busybox
</span></span><span style="display:flex;"><span>8a79                                                                 -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ chmod â†’ /bin/busybox
</span></span><span style="display:flex;"><span>Digest: sha256:f1417ff83b319fbdae6dd9cd6d8c9c88002dcd75ecf6ec201c8c6 -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ chown â†’ /bin/busybox
</span></span><span style="display:flex;"><span>894681cf2b5                                                          -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ cp â†’ /bin/busybox
</span></span><span style="display:flex;"><span>Command:                                                             -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ date â†’ /bin/busybox
</span></span><span style="display:flex;"><span><span style="color:#75715e">#(nop) ADD file:9a4f77dfaba7fd2aa78186e4ef0e7486ad55101cefc1fabbc1b3 -rwxrwxrwx         0:0        0 B  â”‚   â”œâ”€â”€ dd â†’ /bin/busybox</span>
</span></span><span style="display:flex;"><span>85601bb38920 in /                                                    -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ df â†’ /bin/busybox
</span></span><span style="display:flex;"><span>                                                                     -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ dmesg â†’ /bin/busybox
</span></span><span style="display:flex;"><span>â”‚ Image Details â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ dnsdomainname â†’ /bin/busy
</span></span><span style="display:flex;"><span>                                                                     -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ dumpkmap â†’ /bin/busybox
</span></span><span style="display:flex;"><span>                                                                     -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ echo â†’ /bin/busybox
</span></span><span style="display:flex;"><span>Total Image size: <span style="color:#ae81ff">28</span> MB                                              -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ ed â†’ /bin/busybox
</span></span><span style="display:flex;"><span>Potential wasted space: <span style="color:#ae81ff">21</span> MB                                        -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ egrep â†’ /bin/busybox
</span></span><span style="display:flex;"><span>Image efficiency score: <span style="color:#ae81ff">25</span> %                                         -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ false â†’ /bin/busybox
</span></span><span style="display:flex;"><span>                                                                     -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ fatattr â†’ /bin/busybox
</span></span><span style="display:flex;"><span>Count   Total Space  Path                                            -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ fdflush â†’ /bin/busybox
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">3</span>         <span style="color:#ae81ff">21</span> MB  /resource.tar                                   -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ fgrep â†’ /bin/busybox
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>           <span style="color:#ae81ff">0</span> B  /etc                                            -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ fsync â†’ /bin/busybox
</span></span><span style="display:flex;"><span>                                                                     ...
</span></span></code></pre></div><h2 id="é•œåƒä¼˜åŒ–">é•œåƒä¼˜åŒ–<a hidden class="anchor" aria-hidden="true" href="#é•œåƒä¼˜åŒ–">#</a></h2>
<p>é•œåƒï¼ˆä½“ç§¯ï¼‰ä¼˜åŒ–æœ€ä¸»è¦çš„ç›®çš„æ˜¯æ–¹ä¾¿é•œåƒæ›´å¿«é€Ÿæ‹‰å–å’Œåˆ†å‘ï¼ŒåŒæ—¶èŠ‚çœç¡¬ç›˜ç©ºé—´ï¼Œæå‡éƒ¨ç½²æ•ˆç‡ï¼Œä¼˜åŒ–æ–¹å¼å¯ä»¥ä»ä¸‹é¢å‡ ä¸ªæ–¹å¼å…¥æ‰‹ï¼š</p>
<ul>
<li>
<ol>
<li>ä¼˜åŒ–åŸºç¡€é•œåƒï¼Œåœ¨ä¸å½±å“ä¸šåŠ¡ç»´æŠ¤çš„æƒ…å†µä¸‹ï¼Œå°½å¯èƒ½ä½¿ç”¨æ›´å°çš„åŸºç¡€é•œåƒï¼Œå¦‚ï¼šalpineæˆ–image:alpine</li>
</ol>
</li>
<li>
<ol start="2">
<li>ä¼˜åŒ–Dockerfileä¸­æŒ‡ä»¤ï¼Œå¦‚å¤šæ¡RUNæŒ‡ä»¤<code>&amp;&amp;</code>ä¸²è”å†™åœ¨åŒä¸€è¡Œï¼Œä½¿ä¹‹ä»…ç”Ÿæˆä¸€å±‚é•œåƒï¼Œé˜²æ­¢åˆ†å±‚è¿‡å¤š</li>
</ol>
</li>
<li>
<ol start="3">
<li><del>ä½¿ç”¨<code>--squash</code>å‚æ•°å‹ç¼©é•œåƒå±‚ï¼Œå®˜æ–¹æç¤ºå·²å¼ƒç”¨</del>ï¼ˆæœ¬äººç›®å‰ç‰ˆæœ¬æ˜¯23.0.4ï¼‰</li>
</ol>
</li>
<li>
<ol start="4">
<li>å¤šé˜¶æ®µæ„å»ºï¼Œæ›´å¤šä¿¡æ¯å¯ä»¥æŸ¥çœ‹<a href="https://docs.docker.com/build/building/multi-stage/"  target="_blank" rel="noopener" style="color:#42b983" ;>å®˜ç½‘ä»‹ç»</a></li>
</ol>
</li>
<li>
<ol start="5">
<li>æ ¹æ®diveåˆ†æç»“æœä¼˜åŒ–</li>
</ol>
<ul>
<li>å¯¹äºåŸºç¡€é•œåƒï¼ˆæœ€åº•å±‚ï¼‰å¤§äº500MBçš„ï¼Œå»ºè®®é€‰æ‹©æ›´å°çš„åŸºç¡€é•œåƒï¼Œå¦‚åŸºäºalpineçš„é•œåƒ</li>
<li>å¯¹äºåˆ†å±‚å¤§äº10å±‚çš„é•œåƒï¼Œè·å–å„å±‚çš„å‘½ä»¤æ±‡æ€»å±•ç¤ºï¼Œå»ºè®®è°ƒæ•´æŒ‡ä»¤ï¼Œæ˜¯å¦å·²ä½¿ç”¨ä¸²è¿çš„å½¢å¼</li>
<li>é¿å…äº§ç”Ÿæ— ç”¨çš„ç¼“å­˜ï¼Œå¦‚pipåº”ä½¿ç”¨<code>--no-cache-dir</code>ç¦ç”¨ç¼“å­˜ï¼Œ<code>yum makecache</code>ä¹Ÿä¼šäº§ç”Ÿç¼“å­˜</li>
<li>é¿å…æ— ç”¨æ–‡ä»¶ï¼ˆ.md .pdf .txt .docç­‰ä¸€äº›æ–‡æ¡£æ–‡ä»¶ä¸åº”è¯¥å‡ºç°åœ¨é•œåƒä¸­ï¼‰</li>
<li>é¿å…å®‰è£…å¤šä½™çš„è½¯ä»¶</li>
</ul>
</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># å…ˆæ‹‰å–é•œåƒåˆ°æœ¬åœ°ï¼ŒåŠ å¿«åé¢çš„æ„å»ºé€Ÿåº¦</span>
</span></span><span style="display:flex;"><span>docker pull centos:latest
</span></span><span style="display:flex;"><span>docker pull alpine:latest
</span></span><span style="display:flex;"><span>docker pull golang:latest
</span></span><span style="display:flex;"><span>docker pull ubuntu:latest
</span></span><span style="display:flex;"><span>docker pull fedora:28
</span></span></code></pre></div><h3 id="ä¼˜åŒ–åŸºç¡€é•œåƒ">ä¼˜åŒ–åŸºç¡€é•œåƒ<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–åŸºç¡€é•œåƒ">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 base<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>/root/dockerfile/base
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 base<span style="color:#f92672">]</span><span style="color:#75715e"># cat Dockerfile</span>
</span></span><span style="display:flex;"><span>FROM centos
</span></span><span style="display:flex;"><span>CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;echo&#34;</span>, <span style="color:#e6db74">&#34;hi&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 base<span style="color:#f92672">]</span><span style="color:#75715e"># docker build -t base:v1 .</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¿®æ”¹åŸºç¡€é•œåƒ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 base<span style="color:#f92672">]</span><span style="color:#75715e"># cat Dockerfile</span>
</span></span><span style="display:flex;"><span>FROM alpine
</span></span><span style="display:flex;"><span>CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;echo&#34;</span>, <span style="color:#e6db74">&#34;hi&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 base<span style="color:#f92672">]</span><span style="color:#75715e"># docker build -t base:v2 .</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 base<span style="color:#f92672">]</span><span style="color:#75715e"># docker images | grep base</span>
</span></span><span style="display:flex;"><span>base         v2        025106dd85eb   <span style="color:#ae81ff">4</span> weeks ago     7.05MB
</span></span><span style="display:flex;"><span>base         v1        108460ab34b0   <span style="color:#ae81ff">19</span> months ago   231MB
</span></span></code></pre></div><h3 id="ä¸²è”å‘½ä»¤">ä¸²è”å‘½ä»¤<a hidden class="anchor" aria-hidden="true" href="#ä¸²è”å‘½ä»¤">#</a></h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 multirun<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>/root/dockerfile/multirun
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 multirun<span style="color:#f92672">]</span><span style="color:#75715e"># cat Dockerfile</span>
</span></span><span style="display:flex;"><span>FROM fedora:28
</span></span><span style="display:flex;"><span>RUN dnf install -y nginx
</span></span><span style="display:flex;"><span>RUN dnf clean all
</span></span><span style="display:flex;"><span>RUN rm -rf /var/cache/yum
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 multirun<span style="color:#f92672">]</span><span style="color:#75715e"># docker build -t multirun:v1 .</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ†æé•œåƒ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 multirun<span style="color:#f92672">]</span><span style="color:#75715e"># docker images| grep mul</span>
</span></span><span style="display:flex;"><span>multirun     v1        2666d7aa527a   <span style="color:#ae81ff">2</span> minutes ago    488MB
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 multirun<span style="color:#f92672">]</span><span style="color:#75715e"># docker history multirun:v1</span>
</span></span><span style="display:flex;"><span>IMAGE          CREATED          CREATED BY                                      SIZE      COMMENT
</span></span><span style="display:flex;"><span>2666d7aa527a   <span style="color:#ae81ff">17</span> seconds ago   RUN /bin/sh -c rm -rf /var/cache/yum <span style="color:#75715e"># buildâ€¦   0B        buildkit.dockerfile.v0</span>
</span></span><span style="display:flex;"><span>&lt;missing&gt;      <span style="color:#ae81ff">18</span> seconds ago   RUN /bin/sh -c dnf clean all <span style="color:#75715e"># buildkit         1.79MB    buildkit.dockerfile.v0</span>
</span></span><span style="display:flex;"><span>&lt;missing&gt;      <span style="color:#ae81ff">19</span> seconds ago   RUN /bin/sh -c dnf install -y nginx <span style="color:#75715e"># buildkâ€¦   226MB     buildkit.dockerfile.v0</span>
</span></span><span style="display:flex;"><span>&lt;missing&gt;      <span style="color:#ae81ff">4</span> years ago      /bin/sh -c <span style="color:#75715e">#(nop)  CMD [&#34;/bin/bash&#34;]            0B</span>
</span></span><span style="display:flex;"><span>&lt;missing&gt;      <span style="color:#ae81ff">4</span> years ago      /bin/sh -c <span style="color:#75715e">#(nop) ADD file:42ddab590052fda98â€¦   261MB</span>
</span></span><span style="display:flex;"><span>&lt;missing&gt;      <span style="color:#ae81ff">4</span> years ago      /bin/sh -c <span style="color:#75715e">#(nop)  ENV DISTTAG=f28container â€¦   0B</span>
</span></span><span style="display:flex;"><span>&lt;missing&gt;      <span style="color:#ae81ff">4</span> years ago      /bin/sh -c <span style="color:#75715e">#(nop)  LABEL maintainer=Clement â€¦   0B</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 multirun<span style="color:#f92672">]</span><span style="color:#75715e"># dive multirun:v1</span>
</span></span><span style="display:flex;"><span>â”ƒ â— Layers â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ Current Layer Contents â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</span></span><span style="display:flex;"><span>Cmp   Size  Command                                                  Permission     UID:GID       Size  Filetree
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">260</span> MB  FROM 9bfbc900bde2f55                                     -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”œâ”€â”€ bin â†’ usr/bin
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">226</span> MB  RUN /bin/sh -c dnf install -y nginx <span style="color:#75715e"># buildkit           dr-xr-xr-x         0:0        0 B  â”œâ”€â”€ boot</span>
</span></span><span style="display:flex;"><span>    1.8 MB  RUN /bin/sh -c dnf clean all <span style="color:#75715e"># buildkit                  drwxr-xr-x         0:0        0 B  â”œâ”€â”€ dev</span>
</span></span><span style="display:flex;"><span>       <span style="color:#ae81ff">0</span> B  RUN /bin/sh -c rm -rf /var/cache/yum <span style="color:#75715e"># buildkit          drwxr-xr-x         0:0     1.8 MB  â”œâ”€â”€ etc</span>
</span></span><span style="display:flex;"><span>                                                                     -rw-------         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ .pwd.lock
</span></span><span style="display:flex;"><span>â”‚ Layer Details â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -rw-r--r--         0:0     4.5 kB  â”‚   â”œâ”€â”€ DIR_COLORS
</span></span><span style="display:flex;"><span>                                                                     -rw-r--r--         0:0     5.2 kB  â”‚   â”œâ”€â”€ DIR_COLORS.256color
</span></span><span style="display:flex;"><span>Tags:   <span style="color:#f92672">(</span>unavailable<span style="color:#f92672">)</span>                                                -rw-r--r--         0:0     4.6 kB  â”‚   â”œâ”€â”€ DIR_COLORS.lightbgcolor
</span></span><span style="display:flex;"><span>Id:     9bfbc900bde2f55fafbeeed2be52e80c9b06244dee226dc54a354f9d09ea -rw-r--r--         0:0       <span style="color:#ae81ff">94</span> B  â”‚   â”œâ”€â”€ GREP_COLORS
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1910</span>                                                                 drwxr-xr-x         0:0      <span style="color:#ae81ff">203</span> B  â”‚   â”œâ”€â”€ X11
</span></span><span style="display:flex;"><span>Digest: sha256:17beab58d693a5e55591675c3dcc5b575a44e476d125408102ce7 drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â”œâ”€â”€ applnk
</span></span><span style="display:flex;"><span>5348011f807                                                          drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â”œâ”€â”€ fontpath.d
</span></span><span style="display:flex;"><span>Command:                                                             drwxr-xr-x         0:0      <span style="color:#ae81ff">203</span> B  â”‚   â”‚   â”œâ”€â”€ xinit
</span></span><span style="display:flex;"><span><span style="color:#75715e">#(nop) ADD file:42ddab590052fda98865a9ecd9dc28c8d3ba7922a6d21b1f182a drwxr-xr-x         0:0      203 B  â”‚   â”‚   â”‚   â””â”€â”€ xinitrc.d</span>
</span></span><span style="display:flex;"><span>0a3769419677 in /                                                    -rwxr-xr-x         0:0      <span style="color:#ae81ff">203</span> B  â”‚   â”‚   â”‚       â””â”€â”€ 50-systemd-us
</span></span><span style="display:flex;"><span>                                                                     drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â””â”€â”€ xorg.conf.d
</span></span><span style="display:flex;"><span>â”‚ Image Details â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -rw-r--r--         0:0       <span style="color:#ae81ff">16</span> B  â”‚   â”œâ”€â”€ adjtime
</span></span><span style="display:flex;"><span>                                                                     -rw-r--r--         0:0     1.5 kB  â”‚   â”œâ”€â”€ aliases
</span></span><span style="display:flex;"><span>                                                                     drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ alternatives
</span></span><span style="display:flex;"><span>Total Image size: <span style="color:#ae81ff">488</span> MB                                             -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â”œâ”€â”€ cifs-idmap-plugin â†’ /
</span></span><span style="display:flex;"><span>Potential wasted space: <span style="color:#ae81ff">234</span> MB                                       -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â””â”€â”€ libnssckbi.so.x86_64
</span></span><span style="display:flex;"><span>Image efficiency score: <span style="color:#ae81ff">54</span> %                                         drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ bash_completion.d
</span></span><span style="display:flex;"><span>                                                                     -rw-r--r--         0:0     3.0 kB  â”‚   â”œâ”€â”€ bashrc
</span></span><span style="display:flex;"><span>Count   Total Space  Path                                            drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ binfmt.d
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>         <span style="color:#ae81ff">48</span> MB  /var/cache/dnf/fedora-filenames.solvx           drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ chkconfig.d
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>         <span style="color:#ae81ff">47</span> MB  /var/cache/dnf/fedora-f21308f6293b3270/repodata drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ cifs-utils
</span></span><span style="display:flex;"><span>/a53009478e29c551710df570a5dc726ce5160300c7c1ecde852895ab8a6fcf72-fi -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â””â”€â”€ idmap-plugin â†’ /etc/a
</span></span><span style="display:flex;"><span>lelists.xml.gz                                                       drwxr-xr-x         0:0      <span style="color:#ae81ff">614</span> B  â”‚   â”œâ”€â”€ crypto-policies
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>         <span style="color:#ae81ff">24</span> MB  /var/cache/dnf/updates-filenames.solvx          drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â”œâ”€â”€ back-ends
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>         <span style="color:#ae81ff">23</span> MB  /var/cache/dnf/updates-8bd9ef368505a5fd/repodat -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â”‚   â”œâ”€â”€ bind.config â†’ /us
</span></span><span style="display:flex;"><span>a/15dc5106b1b18f200a2f520b561e59fd8a75d921acfd7edf34e8d88db3b9220a-f -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â”‚   â”œâ”€â”€ gnutls.config â†’ /
</span></span><span style="display:flex;"><span>ilelists.xml.gz                                                      -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â”‚   â”œâ”€â”€ java.config â†’ /us
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>         <span style="color:#ae81ff">21</span> MB  /var/cache/dnf/fedora.solv                      -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â”‚   â”œâ”€â”€ krb5.config â†’ /us
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>         <span style="color:#ae81ff">18</span> MB  /var/lib/rpm/Packages                           -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â”‚   â”œâ”€â”€ libreswan.config
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>         <span style="color:#ae81ff">16</span> MB  /var/cache/dnf/fedora-f21308f6293b3270/repodata -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â”‚   â”œâ”€â”€ nss.config â†’ /usr
</span></span><span style="display:flex;"><span>/9659dfc44de50563682658fd41f2ab0da60e5657e1cc4f598b50d39fb3436e0c-pr -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â”‚   â”œâ”€â”€ openssh.config â†’
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä»diveåˆ†æç»“æœå¯ä»¥çœ‹å‡ºä¸ä½†æ¯ä¸ªRUNéƒ½äº§ç”Ÿäº†ä¸€å±‚é•œåƒï¼Œè€Œä¸”å®é™…ä¸Šç¼“å­˜å¹¶æ²¡æœ‰æ¸…ç†æ‰ï¼Œæç¤ºPotential wasted space: 234 MBï¼Œæ½œåœ¨æµªè´¹äº†234MBç©ºé—´</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä¼˜åŒ–RUNå‘½ä»¤</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 multirun<span style="color:#f92672">]</span><span style="color:#75715e"># cat Dockerfile</span>
</span></span><span style="display:flex;"><span>FROM fedora:28
</span></span><span style="display:flex;"><span>RUN dnf install -y nginx<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> <span style="color:#f92672">&amp;&amp;</span> dnf clean all<span style="color:#ae81ff">\
</span></span></span><span style="display:flex;"><span><span style="color:#ae81ff"></span> <span style="color:#f92672">&amp;&amp;</span> rm -rf /var/cache/yum
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 multirun<span style="color:#f92672">]</span><span style="color:#75715e"># docker build -t multirun:v2 .</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 multirun<span style="color:#f92672">]</span><span style="color:#75715e"># dive multirun:v2</span>
</span></span><span style="display:flex;"><span>â”ƒ â— Layers â”£â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚ Current Layer Contents â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
</span></span><span style="display:flex;"><span>Cmp   Size  Command                                                  Permission     UID:GID       Size  Filetree
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">260</span> MB  FROM 9bfbc900bde2f55                                     -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”œâ”€â”€ bin â†’ usr/bin
</span></span><span style="display:flex;"><span>     <span style="color:#ae81ff">18</span> MB  RUN /bin/sh -c dnf install -y nginx <span style="color:#f92672">&amp;&amp;</span> dnf clean all <span style="color:#f92672">&amp;&amp;</span>  dr-xr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”œâ”€â”€ boot
</span></span><span style="display:flex;"><span>                                                                     drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”œâ”€â”€ dev
</span></span><span style="display:flex;"><span>â”‚ Layer Details â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ drwxr-xr-x         0:0     1.8 MB  â”œâ”€â”€ etc
</span></span><span style="display:flex;"><span>                                                                     -rw-------         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ .pwd.lock
</span></span><span style="display:flex;"><span>Tags:   <span style="color:#f92672">(</span>unavailable<span style="color:#f92672">)</span>                                                -rw-r--r--         0:0     4.5 kB  â”‚   â”œâ”€â”€ DIR_COLORS
</span></span><span style="display:flex;"><span>Id:     9bfbc900bde2f55fafbeeed2be52e80c9b06244dee226dc54a354f9d09ea -rw-r--r--         0:0     5.2 kB  â”‚   â”œâ”€â”€ DIR_COLORS.256color
</span></span><span style="display:flex;"><span><span style="color:#ae81ff">1910</span>                                                                 -rw-r--r--         0:0     4.6 kB  â”‚   â”œâ”€â”€ DIR_COLORS.lightbgcolor
</span></span><span style="display:flex;"><span>Digest: sha256:17beab58d693a5e55591675c3dcc5b575a44e476d125408102ce7 -rw-r--r--         0:0       <span style="color:#ae81ff">94</span> B  â”‚   â”œâ”€â”€ GREP_COLORS
</span></span><span style="display:flex;"><span>5348011f807                                                          drwxr-xr-x         0:0      <span style="color:#ae81ff">203</span> B  â”‚   â”œâ”€â”€ X11
</span></span><span style="display:flex;"><span>Command:                                                             drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â”œâ”€â”€ applnk
</span></span><span style="display:flex;"><span><span style="color:#75715e">#(nop) ADD file:42ddab590052fda98865a9ecd9dc28c8d3ba7922a6d21b1f182a drwxr-xr-x         0:0        0 B  â”‚   â”‚   â”œâ”€â”€ fontpath.d</span>
</span></span><span style="display:flex;"><span>0a3769419677 in /                                                    drwxr-xr-x         0:0      <span style="color:#ae81ff">203</span> B  â”‚   â”‚   â”œâ”€â”€ xinit
</span></span><span style="display:flex;"><span>                                                                     drwxr-xr-x         0:0      <span style="color:#ae81ff">203</span> B  â”‚   â”‚   â”‚   â””â”€â”€ xinitrc.d
</span></span><span style="display:flex;"><span>â”‚ Image Details â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -rwxr-xr-x         0:0      <span style="color:#ae81ff">203</span> B  â”‚   â”‚   â”‚       â””â”€â”€ 50-systemd-us
</span></span><span style="display:flex;"><span>                                                                     drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â””â”€â”€ xorg.conf.d
</span></span><span style="display:flex;"><span>                                                                     -rw-r--r--         0:0       <span style="color:#ae81ff">16</span> B  â”‚   â”œâ”€â”€ adjtime
</span></span><span style="display:flex;"><span>Total Image size: <span style="color:#ae81ff">278</span> MB                                             -rw-r--r--         0:0     1.5 kB  â”‚   â”œâ”€â”€ aliases
</span></span><span style="display:flex;"><span>Potential wasted space: <span style="color:#ae81ff">24</span> MB                                        drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ alternatives
</span></span><span style="display:flex;"><span>Image efficiency score: <span style="color:#ae81ff">95</span> %                                         -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â”œâ”€â”€ cifs-idmap-plugin â†’ /
</span></span><span style="display:flex;"><span>                                                                     -rwxrwxrwx         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”‚   â””â”€â”€ libnssckbi.so.x86_64
</span></span><span style="display:flex;"><span>Count   Total Space  Path                                            drwxr-xr-x         0:0        <span style="color:#ae81ff">0</span> B  â”‚   â”œâ”€â”€ bash_completion.d
</span></span><span style="display:flex;"><span>    <span style="color:#ae81ff">2</span>         <span style="color:#ae81ff">18</span> MB  /var/lib/rpm/Packages                           -rw-r--r--         0:0     3.0 kB  â”‚   â”œâ”€â”€ bashr
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ç¼“å­˜å·²æ¸…ç†å¹²å‡€ï¼Œæœ‰æ•ˆç©ºé—´å æ¯”95%ï¼ŒImage efficiency score: 95 %</span>
</span></span></code></pre></div><h3 id="å‹ç¼©é•œåƒå±‚å¼ƒç”¨">å‹ç¼©é•œåƒå±‚ï¼ˆå¼ƒç”¨ï¼‰<a hidden class="anchor" aria-hidden="true" href="#å‹ç¼©é•œåƒå±‚å¼ƒç”¨">#</a></h3>
<p>docker1.13ç‰ˆæœ¬åå¯ä»¥ç›´æ¥ä½¿ç”¨<code>--squash</code>å‚æ•°å‹ç¼©é•œåƒå±‚ï¼Œä¹‹å‰éœ€è¦å•ç‹¬å®‰è£…<code>docker-squash</code>å·¥å…·æ‰èƒ½å®ç°ã€‚ä½†ç›®å‰å·²ç§»é™¤äº†è¿™ä¸ªå‚æ•°ï¼Œä½¿ç”¨ä¹Ÿæ— æ•ˆã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># ä¾æ—§ä»¥ä¸Šé¢RUNä¸ºä¾‹</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 squash<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>/root/dockerfile/squash
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 squash<span style="color:#f92672">]</span><span style="color:#75715e"># cat Dockerfile</span>
</span></span><span style="display:flex;"><span>FROM fedora:28
</span></span><span style="display:flex;"><span>RUN dnf install -y nginx
</span></span><span style="display:flex;"><span>RUN dnf clean all
</span></span><span style="display:flex;"><span>RUN rm -rf /var/cache/yum
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 squash<span style="color:#f92672">]</span><span style="color:#75715e"># docker build -t squash:v1 .</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‹ç¼©å‰488MB</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 squash<span style="color:#f92672">]</span><span style="color:#75715e"># docker images | grep squ</span>
</span></span><span style="display:flex;"><span>squash       v1        2666d7aa527a   <span style="color:#ae81ff">45</span> minutes ago      488MB
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å‘ç°æç¤ºå·²ç§»é™¤è¯¥å‚æ•°ï¼Œæç¤ºä½¿ç”¨å¤šé˜¶æ®µæ„å»º</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 squash<span style="color:#f92672">]</span><span style="color:#75715e"># docker build -t squash:v2 --squash .</span>
</span></span><span style="display:flex;"><span>WARNING: experimental flag squash is removed with BuildKit. You should squash inside build using a multi-stage Dockerfile <span style="color:#66d9ef">for</span> efficiency.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 squash<span style="color:#f92672">]</span><span style="color:#75715e"># docker images | grep squ</span>
</span></span><span style="display:flex;"><span>squash       v1        2666d7aa527a   <span style="color:#ae81ff">46</span> minutes ago      488MB
</span></span><span style="display:flex;"><span>squash       v2        2666d7aa527a   <span style="color:#ae81ff">46</span> minutes ago      488MB
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 squash<span style="color:#f92672">]</span><span style="color:#75715e"># docker version</span>
</span></span><span style="display:flex;"><span>Client: Docker Engine - Community
</span></span><span style="display:flex;"><span> Version:           23.0.4
</span></span><span style="display:flex;"><span>...
</span></span></code></pre></div><blockquote>
<p>æ—¢ç„¶å®˜æ–¹å·²å¼ƒç”¨ï¼Œé‚£å°±ä¸è¯¦ç»†ç ”ç©¶äº†ã€‚å»ºè®®ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºã€‚åŸæœ¬é•œåƒå±‚å‹ç¼©å°±ä¼šé€ æˆå…¶ä»–ç¼“å­˜å±‚æ— æ³•å…±ç”¨ï¼Œå¤±å»äº†é•œåƒçš„ä¼˜åŠ¿ï¼Œåœ¨é•œåƒè¾ƒå¤šçš„æƒ…å†µä¸‹æ— æ³•å…¬ç”¨ï¼Œå­˜å‚¨å¼€é”€æ˜¯å¾ˆå¤§çš„ã€‚</p>
</blockquote>
<h3 id="å¤šé˜¶æ®µæ„å»º">å¤šé˜¶æ®µæ„å»º<a hidden class="anchor" aria-hidden="true" href="#å¤šé˜¶æ®µæ„å»º">#</a></h3>
<p>scratchæ˜¯ä¸€ä¸ªç©ºé•œåƒï¼Œä¸èƒ½æ‹‰å–ä¹Ÿä¸èƒ½è¿è¡Œï¼Œé‡Œé¢ä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œä½†å¯ä»¥ä½œä¸ºåŸºç¡€é•œåƒæ„å»ºå…¶ä»–é•œåƒã€‚</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 go<span style="color:#f92672">]</span><span style="color:#75715e"># pwd</span>
</span></span><span style="display:flex;"><span>/root/dockerfile/go
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 go<span style="color:#f92672">]</span><span style="color:#75715e"># cat hello.go</span>
</span></span><span style="display:flex;"><span>package main
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>import <span style="color:#e6db74">&#34;fmt&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>func main<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>        fmt.Println<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello world.&#34;</span><span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 go<span style="color:#f92672">]</span><span style="color:#75715e"># cat Dockerfile</span>
</span></span><span style="display:flex;"><span>FROM golang
</span></span><span style="display:flex;"><span>COPY hello.go .
</span></span><span style="display:flex;"><span>RUN go build hello.go
</span></span><span style="display:flex;"><span>CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;./hello&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 go<span style="color:#f92672">]</span><span style="color:#75715e"># docker run -it --rm go:v1</span>
</span></span><span style="display:flex;"><span>hello world.
</span></span><span style="display:flex;"><span><span style="color:#75715e"># åˆ†é˜¶æ®µæ„å»ºï¼Œè¿™é‡ŒæŒ‡å®šWORKDIRï¼Œæ–¹ä¾¿å¤åˆ¶å¯æ‰§è¡Œæ–‡ä»¶</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 go<span style="color:#f92672">]</span><span style="color:#75715e"># cat Dockerfile</span>
</span></span><span style="display:flex;"><span>FROM golang AS first
</span></span><span style="display:flex;"><span>WORKDIR /app
</span></span><span style="display:flex;"><span>COPY hello.go .
</span></span><span style="display:flex;"><span>RUN go build hello.go
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FROM scratch
</span></span><span style="display:flex;"><span>COPY --from<span style="color:#f92672">=</span>first /app/hello .
</span></span><span style="display:flex;"><span>CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;./hello&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 go<span style="color:#f92672">]</span><span style="color:#75715e"># docker build -t go:v2 .</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 go<span style="color:#f92672">]</span><span style="color:#75715e"># docker run -it --rm go:v2</span>
</span></span><span style="display:flex;"><span>hello world.
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 go<span style="color:#f92672">]</span><span style="color:#75715e"># docker images | grep go</span>
</span></span><span style="display:flex;"><span>go           v2        d9e76072de38   <span style="color:#ae81ff">29</span> seconds ago   1.85MB
</span></span><span style="display:flex;"><span>go           v1        c5bb11851550   <span style="color:#ae81ff">2</span> minutes ago    804MB
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ä½¿ç”¨éscratché•œåƒ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 go<span style="color:#f92672">]</span><span style="color:#75715e"># cat Dockerfile</span>
</span></span><span style="display:flex;"><span>FROM golang
</span></span><span style="display:flex;"><span>WORKDIR /app
</span></span><span style="display:flex;"><span>COPY hello.go .
</span></span><span style="display:flex;"><span>RUN go build hello.go
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>FROM ubuntu
</span></span><span style="display:flex;"><span>COPY --from<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> /app/hello .
</span></span><span style="display:flex;"><span>CMD <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;./hello&#34;</span><span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 go<span style="color:#f92672">]</span><span style="color:#75715e"># docker build -t go:v3 .</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@centos7 go<span style="color:#f92672">]</span><span style="color:#75715e"># docker images | grep v3</span>
</span></span><span style="display:flex;"><span>go           v3        d1429ea70f10   <span style="color:#ae81ff">13</span> seconds ago   74.6MB
</span></span></code></pre></div><blockquote>
<p>æ³¨æ„åˆ°åˆ†é˜¶æ®µæ„å»ºæ—¶ç”¨äº†<code>--from=first</code>å’Œ<code>--from=0</code>ã€‚<code>--from=0</code>è¡¨ç¤ºFROMæŒ‰åºå·ç®—ï¼ˆä»0å¼€å§‹ï¼‰çš„é˜¶æ®µï¼Œå¯ä»¥ä¸å¿…æŒ‡å®š<code>AS build_name</code>ï¼›<code>--from=first</code>è¿™é‡Œçš„firstå°±æ˜¯æ„å»ºé˜¶æ®µçš„åˆ«åï¼Œç”¨ASæŒ‡å®šåˆ«åï¼Œä»¥ä¾›è°ƒç”¨ã€‚</p>
</blockquote>
<h3 id="ä¼˜åŒ–æ³¨æ„äº‹é¡¹">ä¼˜åŒ–æ³¨æ„äº‹é¡¹<a hidden class="anchor" aria-hidden="true" href="#ä¼˜åŒ–æ³¨æ„äº‹é¡¹">#</a></h3>
<p><strong>scratché•œåƒ</strong>ï¼šè¯¥é•œåƒä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œæ²¡æœ‰shellï¼Œæ²¡æœ‰ç¨‹åºé“¾æ¥åº“ï¼ˆåº“æ–‡ä»¶ï¼‰ï¼Œæ²¡æœ‰è°ƒè¯•å·¥å…·ï¼ˆps/top/pingç­‰ï¼‰ï¼Œæ‰€ä»¥å¦‚æœéœ€è¦è¿™äº›åŠŸèƒ½ï¼Œä¸æ¨èä½¿ç”¨scratché•œåƒï¼Œå¯ä»¥é€‰ç”¨åˆé€‚çš„é•œåƒæ„å»ºï¼Œå¦‚ï¼šbusyboxã€alpineã€ubuntuç­‰</p>
<p><strong>alpineé•œåƒ</strong>ï¼šè¯¥é•œåƒæ ‡å‡†åº“æ˜¯<code>musl libc</code>è€Œä¸æ˜¯<code>glibc</code>ï¼Œç¨‹åºä¾èµ–glibcåº“æ—¶ï¼Œåœ¨alpineä¸­ç¼–è¯‘æ—¶ä¼šå› ä¸ºåº“ç¼ºå¤±è€ŒæŠ¥é”™ã€‚é™¤äº†æ ‡å‡†åº“ï¼Œalpineå¯¹æ–‡ä»¶ç³»ç»Ÿä¹Ÿè¿›è¡Œäº†ç²¾ç®€ï¼ŒPythonç¨‹åºåœ¨alpineä¸­è¿è¡Œæ•ˆç‡éå¸¸ä½ï¼Œæ‰€ä»¥è°¨æ…ä½¿ç”¨ï¼Œå¯ä»¥é€‰æ‹©å…¶ä»–åˆé€‚é•œåƒæ„å»ºï¼Œå¦‚ï¼šbusybox:glibcã€ubuntuã€debian-slimå’Œopenjdk:8-jre-alpineï¼Œå¾ˆå¤šé•œåƒå‘å¸ƒäº†è‡ªå·±å¾—alpineç‰ˆæœ¬ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä½¿ç”¨</p>
<p>ç”Ÿäº§ä¸­æ˜¯å¦ä½¿ç”¨alpineé•œåƒå¯ä»¥å‚è€ƒæ–‡ç« ï¼š<a href="https://ttys3.dev/post/do-not-use-alpine-in-production-environment/"  target="_blank" rel="noopener" style="color:#42b983" ;>alpineé•œåƒåˆ†æ</a></p>
<blockquote>
<p>é•œåƒç²¾ç®€å›ºç„¶é‡è¦ï¼Œä½†å¦‚æœä»¥æå‡ç¨‹åºå¤æ‚åº¦ä¸ºä»£ä»·æ˜¯ä¸å¦¥çš„ã€‚</p>
</blockquote>
<p>é’ˆå¯¹ä¸åŒå¼€å‘è¯­è¨€çš„é•œåƒç²¾ç®€ç­–ç•¥å¯ä»¥å‚è€ƒæ–‡ç« ï¼š<a href="https://zhuanlan.zhihu.com/p/141697080"  target="_blank" rel="noopener" style="color:#42b983" ;>Docker é•œåƒåˆ¶ä½œæ•™ç¨‹ï¼šé’ˆå¯¹ä¸åŒè¯­è¨€çš„ç²¾ç®€ç­–ç•¥</a></p>


        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="next" href="https://deemoprobe.github.io/posts/tech/dockerbuildcontext/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>DockerbuildContext</span>
  </a>
</nav>

        </footer>
    </div>
</article>
</main>

<footer class="footer">
    
        <span id="runtime_span"></span>
        <script
            type="text/javascript">function show_runtime() { window.setTimeout("show_runtime()", 1000); X = new Date("1/1/2023 1:00:00"); Y = new Date(); T = (Y.getTime() - X.getTime()); M = 24 * 60 * 60 * 1000; a = T / M; A = Math.floor(a); b = (a - A) * 24; B = Math.floor(b); c = (b - B) * 60; C = Math.floor((b - B) * 60); D = Math.floor((c - C) * 60); runtime_span.innerHTML = "ç½‘ç«™å·²è¿è¡Œ" + A + "å¤©" + B + "å°æ—¶" + C + "åˆ†" + D + "ç§’" } show_runtime();</script>
    
    
    <br>
    <span>
        Copyright
        &copy;
        2022-2023
        <a href="https://deemoprobe.github.io/" style="color:#939393;">William&#39;s Blog</a>
        All Rights Reserved
    </span>
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"William's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"William's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'ğŸ“„å¤åˆ¶';

        function copyingDone() {
            copybutton.innerText = 'ğŸ‘ŒğŸ»å·²å¤åˆ¶!';
            setTimeout(() => {
                copybutton.innerText = 'ğŸ“„å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"William's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>

<script>
    $("code[class^=language] ").on("mouseover", function () {
        if (this.clientWidth < this.scrollWidth) {
            $(this).css("width", "135%")
            $(this).css("border-top-right-radius", "var(--radius)")
        }
    }).on("mouseout", function () {
        $(this).css("width", "100%")
        $(this).css("border-top-right-radius", "unset")
    })
</script>
</body>

</html>
