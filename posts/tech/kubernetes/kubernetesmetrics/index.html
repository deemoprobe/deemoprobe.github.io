<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>KubernetesMetrics | William&#39;s Blog</title>
<meta name="keywords" content="kubernetes">
<meta name="description" content="Kubernetes Metrics">
<meta name="author" content="deemoprobe">
<link rel="canonical" href="https://deemoprobe.github.io/posts/tech/kubernetes/kubernetesmetrics/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.5a3abd3998ef4439a1a2f08ffdef0d650d48e3674f8f880f1e60bde49717df7a.css" integrity="sha256-Wjq9OZjvRDmhovCP/e8NZQ1I42dPj4gPHmC95JcX33o=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
        onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://deemoprobe.github.io/img/bear.gif">
<link rel="icon" type="image/png" sizes="16x16" href="https://deemoprobe.github.io/img/bear.gif">
<link rel="icon" type="image/png" sizes="32x32" href="https://deemoprobe.github.io/img/bear.gif">
<link rel="apple-touch-icon" href="https://deemoprobe.github.io/img/bear.gif">
<link rel="mask-icon" href="https://deemoprobe.github.io/img/bear.gif">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script defer src="https://unpkg.com/mermaid@8.8.1/dist/mermaid.min.js"></script>


<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">
<script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script src="https://cdn.staticfile.org/jquery/3.6.3/jquery.min.js"></script>


<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="KubernetesMetrics" />
<meta property="og:description" content="Kubernetes Metrics" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://deemoprobe.github.io/posts/tech/kubernetes/kubernetesmetrics/" />
<meta property="og:image" content="https://deemoprobe.github.io/img/kubernetes.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-29T14:32:00+08:00" />
<meta property="article:modified_time" content="2023-04-29T14:32:00+08:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://deemoprobe.github.io/img/kubernetes.png" />
<meta name="twitter:title" content="KubernetesMetrics"/>
<meta name="twitter:description" content="Kubernetes Metrics"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  1 ,
          "name": "ğŸ“šæ–‡ç« ",
          "item": "https://deemoprobe.github.io/posts/"
        },

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "ğŸ‘¨ğŸ»â€ğŸ’» æŠ€æœ¯",
          "item": "https://deemoprobe.github.io/posts/tech/"
        },

        {
          "@type": "ListItem",
          "position":  3 ,
          "name": "Kubernetes",
          "item": "https://deemoprobe.github.io/posts/tech/kubernetes/"
        }, 
    {
      "@type": "ListItem",
      "position":  4 ,
      "name": "KubernetesMetrics",
      "item": "https://deemoprobe.github.io/posts/tech/kubernetes/kubernetesmetrics/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "KubernetesMetrics",
  "name": "KubernetesMetrics",
  "description": "Kubernetes Metrics",
  "keywords": [
    "kubernetes"
  ],
  "articleBody": " ä½¿ç”¨Helméƒ¨ç½²K8Sèµ„æºæŒ‡æ ‡è·å–å·¥å…·: metrics-server\né¡¹ç›®åœ°å€: https://github.com/kubernetes-sigs/metrics-server\n# é»˜è®¤æƒ…å†µä¸‹ä¸‹é¢èµ„æºæŒ‡æ ‡æ˜¯æ— æ³•è·å–çš„ [root@k8s-master ingress]# kubectl top node error: Metrics API not available [root@k8s-master ingress]# kubectl top pod error: Metrics API not available è·å–metrics-server-amd64é•œåƒ\n# åœ¨é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œ docker pull registry.cn-beijing.aliyuncs.com/google_registry/metrics-server-amd64:v0.3.6 docker tag registry.cn-beijing.aliyuncs.com/google_registry/metrics-server-amd64:v0.3.6 k8s.gcr.io/metrics-server-amd64:v0.3.6 docker rmi registry.cn-beijing.aliyuncs.com/google_registry/metrics-server-amd64:v0.3.6 é…ç½®metrics-server.yamlæ–‡ä»¶\n[root@k8s-master kubernetes]# mkdir monitor;cd monitor [root@k8s-master monitor]# vi metrics-server.yaml args: - --logtostderr - --kubelet-insecure-tls - --kubelet-preferred-address-types=InternalIP é€šè¿‡helméƒ¨ç½²metrics-server\n# æ·»åŠ å®˜æ–¹æœ€æ–°çš„Helmä»“åº“ [root@k8s-master monitor]# helm repo add stable https://charts.helm.sh/stable \"stable\" has been added to your repositories [root@k8s-master monitor]# helm repo update Hang tight while we grab the latest from your chart repositories... ...Successfully got an update from the \"apphub\" chart repository ...Successfully got an update from the \"stable\" chart repository Update Complete. âˆHappy Helming!âˆ [root@k8s-master monitor]# helm repo list NAME URL apphub https://apphub.aliyuncs.com stable https://charts.helm.sh/stable # å…ˆæœä¸€æ³¢ [root@k8s-master monitor]# helm search repo stable | grep metrics-server stable/metrics-server 2.11.4 0.3.6 DEPRECATED - Metrics Server is a cluster-wide a... # å®‰è£… [root@k8s-master monitor]# helm install metrics-server stable/metrics-server --namespace kube-system -f metrics-server.yaml NAME: metrics-server LAST DEPLOYED: Tue Jan 12 15:14:57 2021 NAMESPACE: kube-system STATUS: deployed REVISION: 1 NOTES: The metric server has been deployed. In a few minutes you should be able to list metrics using the following command: kubectl get --raw \"/apis/metrics.k8s.io/v1beta1/nodes\" # æŸ¥çœ‹Metrics-Serverç›¸å…³èµ„æº [root@k8s-master monitor]# helm list --namespace=kube-system NAME NAMESPACE REVISION UPDATED STATUS CHART APP VERSION metrics-server kube-system 1 2021-01-12 15:14:57.092114352 +0800 CST deployed metrics-server-2.11.4 0.3.6 [root@k8s-master monitor]# kubectl get deploy -A | grep 'metrics-server' kube-system metrics-server 1/1 1 1 99s [root@k8s-master monitor]# kubectl get pod -A | grep 'metrics-server' kube-system metrics-server-68cc74d4d-7cj44 1/1 Running 0 77s # è·å–nodeèŠ‚ç‚¹èµ„æºå ç”¨æƒ…å†µ [root@k8s-master monitor]# kubectl get --raw \"/apis/metrics.k8s.io/v1beta1/nodes\" {\"kind\":\"NodeMetricsList\",\"apiVersion\":\"metrics.k8s.io/v1beta1\",\"metadata\":{\"selfLink\":\"/apis/metrics.k8s.io/v1beta1/nodes\"},\"items\":[{\"metadata\":{\"name\":\"k8s-master\",\"selfLink\":\"/apis/metrics.k8s.io/v1beta1/nodes/k8s-master\",\"creationTimestamp\":\"2021-01-12T07:18:02Z\"},\"timestamp\":\"2021-01-12T07:17:40Z\",\"window\":\"30s\",\"usage\":{\"cpu\":\"1395283488n\",\"memory\":\"1246356Ki\"}},{\"metadata\":{\"name\":\"k8s-node1\",\"selfLink\":\"/apis/metrics.k8s.io/v1beta1/nodes/k8s-node1\",\"creationTimestamp\":\"2021-01-12T07:18:02Z\"},\"timestamp\":\"2021-01-12T07:17:37Z\",\"window\":\"30s\",\"usage\":{\"cpu\":\"224689267n\",\"memory\":\"997016Ki\"}}]} # æŸ¥çœ‹nodeèŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ [root@k8s-master monitor]# kubectl top node NAME CPU(cores) CPU% MEMORY(bytes) MEMORY% k8s-master 1396m 69% 1217Mi 70% k8s-node1 225m 11% 973Mi 36% # æŸ¥çœ‹æ‰€æœ‰Podçš„èµ„æºä½¿ç”¨æƒ…å†µ [root@k8s-master monitor]# kubectl top po -A NAMESPACE NAME CPU(cores) MEMORY(bytes) default busybox-k8s-master 0m 0Mi default high-priority 1m 1Mi default look-svc-env-k8s-master 0m 0Mi default myapp-deploy1-6c468d6b6c-nr28d 0m 1Mi default myapp-deploy1-6c468d6b6c-w69sz 0m 1Mi default nginx-k8s-master 0m 1Mi default pod-dns-k8s-master 0m 1Mi dev my-nginx-7c4ff94949-9c9m2 0m 1Mi dev myapp-deploy1-6c468d6b6c-cq44z 0m 1Mi dev myapp-deploy1-6c468d6b6c-mzqwd 0m 1Mi dev myapp-deploy2-5fffdcccd5-25qz4 0m 1Mi dev myapp-deploy2-5fffdcccd5-vpcj9 0m 1Mi dev nginx-ingress-nginx-ingress-controller-667cb64f9c-zqg2q 4m 100Mi dev nginx-ingress-nginx-ingress-controller-default-backend-7ccrfv9m 1m 2Mi kube-system calico-kube-controllers-5c6f6b67db-4gwqx 11m 18Mi kube-system calico-node-g5r6h 65m 96Mi kube-system calico-node-tw24f 76m 61Mi kube-system coredns-6d56c8448f-m92h8 14m 20Mi kube-system coredns-6d56c8448f-wh66t 6m 11Mi kube-system etcd-k8s-master 49m 60Mi kube-system kube-apiserver-k8s-master 161m 472Mi kube-system kube-controller-manager-k8s-master 54m 70Mi kube-system kube-proxy-2ld6t 3m 14Mi kube-system kube-proxy-bx9jg 1m 18Mi kube-system kube-scheduler-k8s-master 13m 25Mi kube-system metrics-server-68cc74d4d-7cj44 4m 11Mi metallb-system controller-fb659dc8-c9r7p 3m 7Mi metallb-system speaker-dwl4w 8m 13Mi metallb-system speaker-ptc97 10m 13Mi test my-nginx-7c4ff94949-n5jh8 0m 3Mi test nginxingress-nginx-ingress-controller-cddb9cd67-nddz9 4m 95Mi test nginxingress-nginx-ingress-default-backend-6d7d9db4d7-dwl7n 1m 1Mi ",
  "wordCount" : "626",
  "inLanguage": "en",
  "image":"https://deemoprobe.github.io/img/kubernetes.png","datePublished": "2023-04-29T14:32:00+08:00",
  "dateModified": "2023-04-29T14:32:00+08:00",
  "author":[{
    "@type": "Person",
    "name": "deemoprobe"
  }],
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://deemoprobe.github.io/posts/tech/kubernetes/kubernetesmetrics/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "William's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://deemoprobe.github.io/img/bear.gif"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    (function () {
        let  arr,reg = new RegExp("(^| )"+"change-themes"+"=([^;]*)(;|$)");
        if(arr = document.cookie.match(reg)) {
        } else {
            if (new Date().getHours() >= 19 || new Date().getHours() < 6) {
                document.body.classList.add('dark');
                localStorage.setItem("pref-theme", 'dark');
            } else {
                document.body.classList.remove('dark');
                localStorage.setItem("pref-theme", 'light');
            }
        }
    })()

    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }
</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://deemoprobe.github.io/" accesskey="h" title="William&#39;s Blog (Alt + H)">
            <img src="https://deemoprobe.github.io/img/bear.gif" alt="logo" aria-label="logo"
                 height="35">William&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://deemoprobe.github.io/" title="ğŸ  ä¸»é¡µ">
                <span>ğŸ  ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://deemoprobe.github.io/tags" title="ğŸ¨ æ ‡ç­¾">
                <span>ğŸ¨ æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://deemoprobe.github.io/archives/" title="ğŸ“ˆ å½’æ¡£">
                <span>ğŸ“ˆ å½’æ¡£</span>
                </a>
            </li>
            <li>
                <a href="https://deemoprobe.github.io/tools" title="ğŸª å·¥å…·">
                <span>ğŸª å·¥å…·</span>
                </a>
            </li>
            <li>
                <a href="https://deemoprobe.github.io/search" title="ğŸ” æœç´¢ (Alt &#43; /)" accesskey=/>
                <span>ğŸ” æœç´¢</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }
</style>

<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            
            <h1 class="post-title">
                KubernetesMetrics
            </h1>
            <div class="post-description">
                Kubernetes Metrics
            </div>
            <div class="post-meta">

<style>
    i[id*="post_meta_style"] {
        display: flex;
        align-items: center;
        margin: 0 0 10px 0;
    }

    .parent-post-meta {
        display: flex;
        flex-wrap: wrap;
        opacity: 0.8;
    }
</style>

<span class="parent-post-meta">
    <span id="post_meta_style_1">
        <span class="fa fa-calendar-check-o"></span>
        <span>2023-04-29
            &nbsp;&nbsp;
        </span>
    </span>
    
    
    
    
    
    
    
    <span id="post_meta_style_3">
        <span class="fa fa-file-word-o"></span>
        <span>626å­—
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_4">
        <span class="fa fa-clock-o"></span>
        <span>2åˆ†é’Ÿ
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_5">
        <span class="fa fa-user-o"></span>
        <span>deemoprobe
            &nbsp;&nbsp;
        </span>
    </span>
    <span id="post_meta_style_6">
        <span class="fa fa-tags" style="opacity: 0.8"></span>
        <span>
            <span class="post-tags-meta">
                <a href="https://deemoprobe.github.io/tags/kubernetes/" style="color: var(--secondary)!important;">kubernetes</a>
            </span>
        </span>
    </span>
</span>
<span style="opacity: 0.8;">
                    <span id="post_meta_style_7">
                        &nbsp;&nbsp;
                        <span class="fa fa-eye" ></span>
                        <span>
                            <span id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv"></span></span>
                            &nbsp;&nbsp;
                        </span>
                    </span>
                    
                </span>

</div>
        </header> 
<figure class="entry-cover1"><img style="zoom:;" loading="lazy" src="https://deemoprobe.github.io/img/kubernetes.png" alt="">
    
</figure>
        <div class="post-content"><blockquote>
<p>ä½¿ç”¨Helméƒ¨ç½²K8Sèµ„æºæŒ‡æ ‡è·å–å·¥å…·: metrics-server</p>
</blockquote>
<p>é¡¹ç›®åœ°å€: <a href="https://github.com/kubernetes-sigs/metrics-server"  target="_blank" rel="noopener" style="color:#42b983" ;>https://github.com/kubernetes-sigs/metrics-server</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># é»˜è®¤æƒ…å†µä¸‹ä¸‹é¢èµ„æºæŒ‡æ ‡æ˜¯æ— æ³•è·å–çš„</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ingress<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl top node</span>
</span></span><span style="display:flex;"><span>error: Metrics API not available
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master ingress<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl top pod</span>
</span></span><span style="display:flex;"><span>error: Metrics API not available
</span></span></code></pre></div><p>è·å–metrics-server-amd64é•œåƒ</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># åœ¨é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹éƒ½éœ€è¦æ‰§è¡Œ</span>
</span></span><span style="display:flex;"><span>docker pull registry.cn-beijing.aliyuncs.com/google_registry/metrics-server-amd64:v0.3.6
</span></span><span style="display:flex;"><span>docker tag  registry.cn-beijing.aliyuncs.com/google_registry/metrics-server-amd64:v0.3.6 k8s.gcr.io/metrics-server-amd64:v0.3.6
</span></span><span style="display:flex;"><span>docker rmi  registry.cn-beijing.aliyuncs.com/google_registry/metrics-server-amd64:v0.3.6
</span></span></code></pre></div><p>é…ç½®metrics-server.yamlæ–‡ä»¶</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master kubernetes<span style="color:#f92672">]</span><span style="color:#75715e"># mkdir monitor;cd monitor</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master monitor<span style="color:#f92672">]</span><span style="color:#75715e"># vi metrics-server.yaml </span>
</span></span><span style="display:flex;"><span>args:
</span></span><span style="display:flex;"><span>- --logtostderr
</span></span><span style="display:flex;"><span>- --kubelet-insecure-tls
</span></span><span style="display:flex;"><span>- --kubelet-preferred-address-types<span style="color:#f92672">=</span>InternalIP
</span></span></code></pre></div><p>é€šè¿‡helméƒ¨ç½²metrics-server</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># æ·»åŠ å®˜æ–¹æœ€æ–°çš„Helmä»“åº“</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master monitor<span style="color:#f92672">]</span><span style="color:#75715e"># helm repo add stable https://charts.helm.sh/stable</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;stable&#34;</span> has been added to your repositories
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master monitor<span style="color:#f92672">]</span><span style="color:#75715e"># helm repo update</span>
</span></span><span style="display:flex;"><span>Hang tight <span style="color:#66d9ef">while</span> we grab the latest from your chart repositories...
</span></span><span style="display:flex;"><span>...Successfully got an update from the <span style="color:#e6db74">&#34;apphub&#34;</span> chart repository
</span></span><span style="display:flex;"><span>...Successfully got an update from the <span style="color:#e6db74">&#34;stable&#34;</span> chart repository
</span></span><span style="display:flex;"><span>Update Complete. âˆHappy Helming!âˆ
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master monitor<span style="color:#f92672">]</span><span style="color:#75715e"># helm repo list</span>
</span></span><span style="display:flex;"><span>NAME    URL                          
</span></span><span style="display:flex;"><span>apphub  https://apphub.aliyuncs.com  
</span></span><span style="display:flex;"><span>stable  https://charts.helm.sh/stable
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å…ˆæœä¸€æ³¢</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master monitor<span style="color:#f92672">]</span><span style="color:#75715e"># helm search repo stable | grep metrics-server</span>
</span></span><span style="display:flex;"><span>stable/metrics-server                   2.11.4          0.3.6                   DEPRECATED - Metrics Server is a cluster-wide a...
</span></span><span style="display:flex;"><span><span style="color:#75715e"># å®‰è£…</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master monitor<span style="color:#f92672">]</span><span style="color:#75715e"># helm install metrics-server stable/metrics-server --namespace kube-system -f metrics-server.yaml</span>
</span></span><span style="display:flex;"><span>NAME: metrics-server
</span></span><span style="display:flex;"><span>LAST DEPLOYED: Tue Jan <span style="color:#ae81ff">12</span> 15:14:57 <span style="color:#ae81ff">2021</span>
</span></span><span style="display:flex;"><span>NAMESPACE: kube-system
</span></span><span style="display:flex;"><span>STATUS: deployed
</span></span><span style="display:flex;"><span>REVISION: <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>NOTES:
</span></span><span style="display:flex;"><span>The metric server has been deployed. 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>In a few minutes you should be able to list metrics using the following
</span></span><span style="display:flex;"><span>command:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  kubectl get --raw <span style="color:#e6db74">&#34;/apis/metrics.k8s.io/v1beta1/nodes&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹Metrics-Serverç›¸å…³èµ„æº</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master monitor<span style="color:#f92672">]</span><span style="color:#75715e"># helm list --namespace=kube-system</span>
</span></span><span style="display:flex;"><span>NAME            NAMESPACE       REVISION        UPDATED                                 STATUS          CHART                   APP VERSION
</span></span><span style="display:flex;"><span>metrics-server  kube-system     <span style="color:#ae81ff">1</span>               2021-01-12 15:14:57.092114352 +0800 CST deployed        metrics-server-2.11.4   0.3.6      
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master monitor<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get deploy -A | grep &#39;metrics-server&#39;</span>
</span></span><span style="display:flex;"><span>kube-system      metrics-server                                           1/1     <span style="color:#ae81ff">1</span>            <span style="color:#ae81ff">1</span>           99s
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master monitor<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get pod -A | grep &#39;metrics-server&#39;</span>
</span></span><span style="display:flex;"><span>kube-system      metrics-server-68cc74d4d-7cj44                                    1/1     Running            <span style="color:#ae81ff">0</span>          77s
</span></span><span style="display:flex;"><span><span style="color:#75715e"># è·å–nodeèŠ‚ç‚¹èµ„æºå ç”¨æƒ…å†µ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master monitor<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl get --raw &#34;/apis/metrics.k8s.io/v1beta1/nodes&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">{</span><span style="color:#e6db74">&#34;kind&#34;</span>:<span style="color:#e6db74">&#34;NodeMetricsList&#34;</span>,<span style="color:#e6db74">&#34;apiVersion&#34;</span>:<span style="color:#e6db74">&#34;metrics.k8s.io/v1beta1&#34;</span>,<span style="color:#e6db74">&#34;metadata&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;selfLink&#34;</span>:<span style="color:#e6db74">&#34;/apis/metrics.k8s.io/v1beta1/nodes&#34;</span><span style="color:#f92672">}</span>,<span style="color:#e6db74">&#34;items&#34;</span>:<span style="color:#f92672">[{</span><span style="color:#e6db74">&#34;metadata&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;k8s-master&#34;</span>,<span style="color:#e6db74">&#34;selfLink&#34;</span>:<span style="color:#e6db74">&#34;/apis/metrics.k8s.io/v1beta1/nodes/k8s-master&#34;</span>,<span style="color:#e6db74">&#34;creationTimestamp&#34;</span>:<span style="color:#e6db74">&#34;2021-01-12T07:18:02Z&#34;</span><span style="color:#f92672">}</span>,<span style="color:#e6db74">&#34;timestamp&#34;</span>:<span style="color:#e6db74">&#34;2021-01-12T07:17:40Z&#34;</span>,<span style="color:#e6db74">&#34;window&#34;</span>:<span style="color:#e6db74">&#34;30s&#34;</span>,<span style="color:#e6db74">&#34;usage&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;cpu&#34;</span>:<span style="color:#e6db74">&#34;1395283488n&#34;</span>,<span style="color:#e6db74">&#34;memory&#34;</span>:<span style="color:#e6db74">&#34;1246356Ki&#34;</span><span style="color:#f92672">}}</span>,<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;metadata&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;k8s-node1&#34;</span>,<span style="color:#e6db74">&#34;selfLink&#34;</span>:<span style="color:#e6db74">&#34;/apis/metrics.k8s.io/v1beta1/nodes/k8s-node1&#34;</span>,<span style="color:#e6db74">&#34;creationTimestamp&#34;</span>:<span style="color:#e6db74">&#34;2021-01-12T07:18:02Z&#34;</span><span style="color:#f92672">}</span>,<span style="color:#e6db74">&#34;timestamp&#34;</span>:<span style="color:#e6db74">&#34;2021-01-12T07:17:37Z&#34;</span>,<span style="color:#e6db74">&#34;window&#34;</span>:<span style="color:#e6db74">&#34;30s&#34;</span>,<span style="color:#e6db74">&#34;usage&#34;</span>:<span style="color:#f92672">{</span><span style="color:#e6db74">&#34;cpu&#34;</span>:<span style="color:#e6db74">&#34;224689267n&#34;</span>,<span style="color:#e6db74">&#34;memory&#34;</span>:<span style="color:#e6db74">&#34;997016Ki&#34;</span><span style="color:#f92672">}}]}</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹nodeèŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master monitor<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl top node</span>
</span></span><span style="display:flex;"><span>NAME         CPU<span style="color:#f92672">(</span>cores<span style="color:#f92672">)</span>   CPU%   MEMORY<span style="color:#f92672">(</span>bytes<span style="color:#f92672">)</span>   MEMORY%   
</span></span><span style="display:flex;"><span>k8s-master   1396m        69%    1217Mi          70%       
</span></span><span style="display:flex;"><span>k8s-node1    225m         11%    973Mi           36%  
</span></span><span style="display:flex;"><span><span style="color:#75715e"># æŸ¥çœ‹æ‰€æœ‰Podçš„èµ„æºä½¿ç”¨æƒ…å†µ</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">[</span>root@k8s-master monitor<span style="color:#f92672">]</span><span style="color:#75715e"># kubectl top po -A</span>
</span></span><span style="display:flex;"><span>NAMESPACE        NAME                                                              CPU<span style="color:#f92672">(</span>cores<span style="color:#f92672">)</span>   MEMORY<span style="color:#f92672">(</span>bytes<span style="color:#f92672">)</span>   
</span></span><span style="display:flex;"><span>default          busybox-k8s-master                                                0m           0Mi             
</span></span><span style="display:flex;"><span>default          high-priority                                                     1m           1Mi             
</span></span><span style="display:flex;"><span>default          look-svc-env-k8s-master                                           0m           0Mi             
</span></span><span style="display:flex;"><span>default          myapp-deploy1-6c468d6b6c-nr28d                                    0m           1Mi             
</span></span><span style="display:flex;"><span>default          myapp-deploy1-6c468d6b6c-w69sz                                    0m           1Mi             
</span></span><span style="display:flex;"><span>default          nginx-k8s-master                                                  0m           1Mi             
</span></span><span style="display:flex;"><span>default          pod-dns-k8s-master                                                0m           1Mi             
</span></span><span style="display:flex;"><span>dev              my-nginx-7c4ff94949-9c9m2                                         0m           1Mi             
</span></span><span style="display:flex;"><span>dev              myapp-deploy1-6c468d6b6c-cq44z                                    0m           1Mi             
</span></span><span style="display:flex;"><span>dev              myapp-deploy1-6c468d6b6c-mzqwd                                    0m           1Mi             
</span></span><span style="display:flex;"><span>dev              myapp-deploy2-5fffdcccd5-25qz4                                    0m           1Mi             
</span></span><span style="display:flex;"><span>dev              myapp-deploy2-5fffdcccd5-vpcj9                                    0m           1Mi             
</span></span><span style="display:flex;"><span>dev              nginx-ingress-nginx-ingress-controller-667cb64f9c-zqg2q           4m           100Mi           
</span></span><span style="display:flex;"><span>dev              nginx-ingress-nginx-ingress-controller-default-backend-7ccrfv9m   1m           2Mi             
</span></span><span style="display:flex;"><span>kube-system      calico-kube-controllers-5c6f6b67db-4gwqx                          11m          18Mi            
</span></span><span style="display:flex;"><span>kube-system      calico-node-g5r6h                                                 65m          96Mi            
</span></span><span style="display:flex;"><span>kube-system      calico-node-tw24f                                                 76m          61Mi            
</span></span><span style="display:flex;"><span>kube-system      coredns-6d56c8448f-m92h8                                          14m          20Mi            
</span></span><span style="display:flex;"><span>kube-system      coredns-6d56c8448f-wh66t                                          6m           11Mi            
</span></span><span style="display:flex;"><span>kube-system      etcd-k8s-master                                                   49m          60Mi            
</span></span><span style="display:flex;"><span>kube-system      kube-apiserver-k8s-master                                         161m         472Mi           
</span></span><span style="display:flex;"><span>kube-system      kube-controller-manager-k8s-master                                54m          70Mi            
</span></span><span style="display:flex;"><span>kube-system      kube-proxy-2ld6t                                                  3m           14Mi            
</span></span><span style="display:flex;"><span>kube-system      kube-proxy-bx9jg                                                  1m           18Mi            
</span></span><span style="display:flex;"><span>kube-system      kube-scheduler-k8s-master                                         13m          25Mi            
</span></span><span style="display:flex;"><span>kube-system      metrics-server-68cc74d4d-7cj44                                    4m           11Mi            
</span></span><span style="display:flex;"><span>metallb-system   controller-fb659dc8-c9r7p                                         3m           7Mi             
</span></span><span style="display:flex;"><span>metallb-system   speaker-dwl4w                                                     8m           13Mi            
</span></span><span style="display:flex;"><span>metallb-system   speaker-ptc97                                                     10m          13Mi            
</span></span><span style="display:flex;"><span>test             my-nginx-7c4ff94949-n5jh8                                         0m           3Mi             
</span></span><span style="display:flex;"><span>test             nginxingress-nginx-ingress-controller-cddb9cd67-nddz9             4m           95Mi            
</span></span><span style="display:flex;"><span>test             nginxingress-nginx-ingress-default-backend-6d7d9db4d7-dwl7n       1m           1Mi 
</span></span></code></pre></div>

        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="prev" href="https://deemoprobe.github.io/posts/tech/kubernetes/kubernetesservicediscovery/">
    <span class="title">Â« ä¸Šä¸€é¡µ</span>
    <br>
    <span>KubernetesServiceDiscovery</span>
  </a>
  <a class="next" href="https://deemoprobe.github.io/posts/tech/kubernetes/kubernetestroubleshooting/">
    <span class="title">ä¸‹ä¸€é¡µ Â»</span>
    <br>
    <span>KubernetesTroubleShooting</span>
  </a>
</nav>

        </footer>
    </div>
</article>
</main>

<footer class="footer">
    
        <span id="runtime_span"></span>
        <script
            type="text/javascript">function show_runtime() { window.setTimeout("show_runtime()", 1000); X = new Date("1/1/2023 1:00:00"); Y = new Date(); T = (Y.getTime() - X.getTime()); M = 24 * 60 * 60 * 1000; a = T / M; A = Math.floor(a); b = (a - A) * 24; B = Math.floor(b); c = (b - B) * 60; C = Math.floor((b - B) * 60); D = Math.floor((c - C) * 60); runtime_span.innerHTML = "ç½‘ç«™å·²è¿è¡Œ" + A + "å¤©" + B + "å°æ—¶" + C + "åˆ†" + D + "ç§’" } show_runtime();</script>
    
    
    <br>
    <span>
        Copyright
        &copy;
        2022-2023
        <a href="https://deemoprobe.github.io/" style="color:#939393;">William&#39;s Blog</a>
        All Rights Reserved
    </span>
    
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });
</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 200 || document.documentElement.scrollTop > 200) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        (function() {
            document.cookie = "change-themes" + "="+ escape ("false");
        })()

        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    });
</script>

<script>
    document.body.addEventListener('copy', function (e) {
        if (window.getSelection().toString() && window.getSelection().toString().length > 50) {
            let clipboardData = e.clipboardData || window.clipboardData;
            if (clipboardData) {
                e.preventDefault();
                let htmlData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"William's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                let textData = window.getSelection().toString() +
                    '\r\n\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"William's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                clipboardData.setData('text/html', htmlData);
                clipboardData.setData('text/plain', textData);
            }
        }
    });
</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;
        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'ğŸ“„å¤åˆ¶';

        function copyingDone() {
            copybutton.innerText = 'ğŸ‘ŒğŸ»å·²å¤åˆ¶!';
            setTimeout(() => {
                copybutton.innerText = 'ğŸ“„å¤åˆ¶';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\nâ€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”\r\n' +
                    'ç‰ˆæƒå£°æ˜ï¼šæœ¬æ–‡ä¸ºã€Œ'+"William's Blog"+'ã€çš„åŸåˆ›æ–‡ç« ï¼Œéµå¾ªCC 4.0 BY-SAç‰ˆæƒåè®®ï¼Œè½¬è½½è¯·é™„ä¸ŠåŸæ–‡å‡ºå¤„é“¾æ¥åŠæœ¬å£°æ˜ã€‚' +
                '\r\nåŸæ–‡é“¾æ¥ï¼š' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {}
            selection.removeRange(range);
        });

        let language = codeblock.className.replaceAll("language-", "")
        let macTool = document.createElement("div")
        let macTool1 = document.createElement("div")
        let macTool2 = document.createElement("div")
        let macTool3 = document.createElement("div")
        let languageType = document.createElement("div")
        languageType.innerText = language
        macTool.setAttribute('class', 'mac-tool')
        macTool1.setAttribute('class', 'mac bb1')
        macTool2.setAttribute('class', 'mac bb2')
        macTool3.setAttribute('class', 'mac bb3')
        languageType.setAttribute('class', 'language-type')
        macTool.appendChild(macTool1)
        macTool.appendChild(macTool2)
        macTool.appendChild(macTool3)
        macTool.appendChild(languageType)

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
            container.appendChild(macTool)
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
            container.appendChild(macTool)
        }
    });
</script>

<script>
    $("code[class^=language] ").on("mouseover", function () {
        if (this.clientWidth < this.scrollWidth) {
            $(this).css("width", "135%")
            $(this).css("border-top-right-radius", "var(--radius)")
        }
    }).on("mouseout", function () {
        $(this).css("width", "100%")
        $(this).css("border-top-right-radius", "unset")
    })
</script>
</body>

</html>
